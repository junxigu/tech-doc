<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">






<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body><div id="bd_snap">
    <div id="bd_snap_head">
        <a href="http://www.baidu.com/" id="bd_snap_logo" title="到百度首页"></a>
    </div>
    <div id="bd_snap_txt">您查询的关键词是：<span><a style="color: black; background-color: rgb(255, 255, 102); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f7327e95804b22818448e435061e5a00b9ec3022667b8e9a2b3b47b21a1cbbaa6d36601e20b599c39548d9a6922b32822d34721e9141658058ed8152609c60c655acf445a6e7a16b84afa2c4ae2044bd20120af6e7fc5a&amp;p=9b759a46d0c915fc57ee973d1141cc78&amp;user=baidu&amp;fm=sc&amp;query=winsock%CF%EA%BD%E2&amp;qid=def30dbb0fe47c3d&amp;p1=2#baidusnap0">winsock详解</a></span> 。如果打开速度慢，可以尝试<a href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f7327e95804b22818448e435061e5a00b9ec3022667b8e9a2b3b47b21a1cbbaa6d36601e20b599c39548d9a6922b32822d34721e9141658058ed8152609c60c655acf445a6e7a16b84afa2c4ae2044bd20120af6e7fc5a&amp;p=9b759a46d0c915fc57ee973d1141cc78&amp;user=baidu&amp;fm=sc&amp;query=winsock%CF%EA%BD%E2&amp;qid=def30dbb0fe47c3d&amp;p1=2&amp;fast=y">快速版</a>；如果想保存快照，可以<a onclick="window.open('http://cang.baidu.com/do/add?it='+encodeURIComponent(document.title)+'&amp;iu='+encodeURIComponent(location.href)+'&amp;fr=ps#nw=1','_s','scrollbars=no,width=600,height=450,right=75,top=20,status=no,resizable=yes'); return false;" href="http://cang.baidu.com/do/add" target="_top">添加到搜藏</a>；如果想更新或删除快照，可以<a href="http://tousu.baidu.com/webmaster/add?link=http%3A%2F%2Fcache.baidu.com%2Fc%3Fm%3D9f65cb4a8c8507ed4fece763105392230e54f7327e95804b22818448e435061e5a00b9ec3022667b8e9a2b3b47b21a1cbbaa6d36601e20b599c39548d9a6922b32822d34721e9141658058ed8152609c60c655acf445a6e7a16b84afa2c4ae2044bd20120af6e7fc5a%26p%3D9b759a46d0c915fc57ee973d1141cc78%26user%3Dbaidu%26fm%3Dsc%26query%3Dwinsock%25CF%25EA%25BD%25E2%26qid%3Ddef30dbb0fe47c3d%26p1%3D2" id="bd_tousu">投诉快照</a>。</div>

    <div id="bd_snap_note">(百度和网页<a href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx">http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx</a>的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。)</div>
</div>
<div id="bd_snap_search">
	<form action="http://www.baidu.com/s"><input name="cl" value="3" type="hidden"><input value="" name="wd" id="bd_snap_kw" maxlength="100"><span id="bd_snap_btn_wr"><input id="bd_snap_su" value="百度一下" class="bd_snap_btn" onmousedown="this.className='bd_snap_btn bd_snap_btn_h'" type="submit"></span></form>
</div>
<div id="bd_snap_ln"></div>
<div style="position: relative;">


<title>
	Winsock详解 - The-Moment - C++博客
</title><meta id="metaKeywords" name="keywords" content="Winsock详解"><link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cppblog.com/The-Moment/rss.aspx">

    <form name="Form1" method="post" action="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx" id="Form1">
<input name="__VIEWSTATE" id="
__VIEWSTATE" value="" type="hidden">


												

        
<!--done-->
<table align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
	<td background="banner1.gif" width="184"></td>
	<td background="banner.gif">
<!--done-->
<div class="header">
	<div class="headerText">
		<a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cppblog.com/The-Moment/">The-Moment</a><br>
		<span style="font-size: 12px; color: rgb(67, 113, 166);"></span>
	</div>
</div>
</td>
	<td background="banner2.gif" width="295"></td>
</tr>
</tbody></table>
<div id="mylinks">
<!--done-->
<a id="MyLinks1_HomeLink" class="menu" href="http://www.cppblog.com/">C++博客</a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_MyHomeLink" class="mainmenu" href="http://www.cppblog.com/The-Moment/">首页</a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_NewPostLink" class="mainmenu" href="http://www.cppblog.com/The-Moment/admin/EditPosts.aspx?opt=1">新随笔</a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_NewArticleLink" class="mainmenu" href="http://www.cppblog.com/EnterMyBlog.aspx?NewArticle=1">新文章</a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_ContactLink" accesskey="9" class="mainmenu" href="http://www.cppblog.com/The-Moment/contact.aspx?id=1">联系</a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_Syndication" class="mainmenu" href="http://www.cppblog.com/The-Moment/Rss.aspx">聚合</a><a id="MyLinks1_XMLLink" href="http://www.cppblog.com/The-Moment/Rss.aspx"><img src="xml.gif" border="0"></a>&nbsp;&nbsp;&nbsp;<a id="MyLinks1_Admin" class="menu" href="http://www.cppblog.com/The-Moment/admin/EditPosts.aspx">管理</a>
</div>
<div id="mytopmenu">
	
		<div id="mystats">
			
<!--done-->
<div class="blogStats">
posts - 29,comments - 6,trackbacks - 0

</div></div>
	
</div>
<div id="leftcontent" style="display: none;">
	
		<div id="leftcontentcontainer">
			<table id="Calendar1_entryCal" class="Cal" title="Calendar" style="border: 0px none;" border="0" cellpadding="0" cellspacing="0">
	<tbody><tr><td colspan="7" bgcolor="Transparent"><table class="CalTitle" border="0" cellspacing="0" width="100%">
		<tbody><tr><td class="CalNextPrev" width="15%"><a href="javascript:__doPostBack('Calendar1$entryCal','V4474')" style="color: Black;" title="Go to the previous month">&lt;</a></td><td align="center" width="70%">2012年5月</td><td class="CalNextPrev" align="right" width="15%"><a href="javascript:__doPostBack('Calendar1$entryCal','V4535')" style="color: Black;" title="Go to the next month">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" abbr="日" scope="col" align="center">日</th><th class="CalDayHeader" abbr="一" scope="col" align="center">一</th><th class="CalDayHeader" abbr="二" scope="col" align="center">二</th><th class="CalDayHeader" abbr="三" scope="col" align="center">三</th><th class="CalDayHeader" abbr="四" scope="col" align="center">四</th><th class="CalDayHeader" abbr="五" scope="col" align="center">五</th><th class="CalDayHeader" abbr="六" scope="col" align="center">六</th></tr><tr><td class="CalOtherMonthDay" align="center" width="14%">29</td><td class="CalOtherMonthDay" align="center" width="14%">30</td><td align="center" width="14%">1</td><td align="center" width="14%">2</td><td class="CalTodayDay" align="center" width="14%">3</td><td align="center" width="14%">4</td><td class="CalWeekendDay" align="center" width="14%">5</td></tr><tr><td class="CalWeekendDay" align="center" width="14%">6</td><td align="center" width="14%">7</td><td align="center" width="14%">8</td><td align="center" width="14%">9</td><td align="center" width="14%">10</td><td align="center" width="14%">11</td><td class="CalWeekendDay" align="center" width="14%">12</td></tr><tr><td class="CalWeekendDay" align="center" width="14%">13</td><td align="center" width="14%">14</td><td align="center" width="14%">15</td><td align="center" width="14%">16</td><td align="center" width="14%">17</td><td align="center" width="14%">18</td><td class="CalWeekendDay" align="center" width="14%">19</td></tr><tr><td class="CalWeekendDay" align="center" width="14%">20</td><td align="center" width="14%">21</td><td align="center" width="14%">22</td><td align="center" width="14%">23</td><td align="center" width="14%">24</td><td align="center" width="14%">25</td><td class="CalWeekendDay" align="center" width="14%">26</td></tr><tr><td class="CalWeekendDay" align="center" width="14%">27</td><td align="center" width="14%">28</td><td align="center" width="14%">29</td><td align="center" width="14%">30</td><td align="center" width="14%">31</td><td class="CalOtherMonthDay" align="center" width="14%">1</td><td class="CalOtherMonthDay" align="center" width="14%">2</td></tr><tr><td class="CalOtherMonthDay" align="center" width="14%">3</td><td class="CalOtherMonthDay" align="center" width="14%">4</td><td class="CalOtherMonthDay" align="center" width="14%">5</td><td class="CalOtherMonthDay" align="center" width="14%">6</td><td class="CalOtherMonthDay" align="center" width="14%">7</td><td class="CalOtherMonthDay" align="center" width="14%">8</td><td class="CalOtherMonthDay" align="center" width="14%">9</td></tr>
</tbody></table>
<br>
			
			
<h3>常用链接</h3>
<ul>
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl01_lnkLinkItem" href="http://www.cppblog.com/The-Moment/MyPosts.html">我的随笔</a></li>
	
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl02_lnkLinkItem" href="http://www.cppblog.com/The-Moment/MyComments.html">我的评论</a></li>
	
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl03_lnkLinkItem" href="http://www.cppblog.com/The-Moment/OtherPosts.html">我参与的随笔</a></li>
	</ul>
<h3>留言簿</h3>
<ul>
	<li>
		<a id="SingleColumn1__354e3db_lnkMessages" href="http://www.cppblog.com/The-Moment/Contact.aspx?id=1">给我留言</a>
	</li><li>
		<a id="SingleColumn1__354e3db_lnkPublicMsgView" href="http://www.cppblog.com/The-Moment/default.aspx?opt=msg">查看公开留言</a>
	</li><li>
		<a id="SingleColumn1__354e3db_lnkPrivateMsgView" href="http://www.cppblog.com/The-Moment/admin/MyMessages.aspx">查看私人留言</a>
	</li>
</ul>

<!--done-->

		<h1 class="catListTitle">随笔分类</h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/10912.html">ACM(1)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_RssLink" title="Subscribe to ACM(1)" class="listitem" href="http://www.cppblog.com/The-Moment/category/10912.html/rss"><img title="Subscribe to ACM(1)" src="xml_001.gif" border="0"></a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/10911.html">C\C++(9)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_RssLink" title="Subscribe to C\C++(9)" class="listitem" href="http://www.cppblog.com/The-Moment/category/10911.html/rss"><img title="Subscribe to C\C++(9)" src="xml_001.gif" border="0"></a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl03_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/11268.html">COM(1)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl03_RssLink" title="Subscribe to COM(1)" class="listitem" href="http://www.cppblog.com/The-Moment/category/11268.html/rss"><img title="Subscribe to COM(1)" src="xml_001.gif" border="0"></a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl04_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/10913.html">VC理论(8)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl04_RssLink" title="Subscribe to VC理论(8)" class="listitem" href="http://www.cppblog.com/The-Moment/category/10913.html/rss"><img title="Subscribe to VC理论(8)" src="xml_001.gif" border="0"></a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl05_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/11061.html">VC实践(7)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl05_RssLink" title="Subscribe to VC实践(7)" class="listitem" href="http://www.cppblog.com/The-Moment/category/11061.html/rss"><img title="Subscribe to VC实践(7)" src="xml_001.gif" border="0"></a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl06_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/11275.html">杂记(3)</a><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl06_RssLink" title="Subscribe to 杂记(3)" class="listitem" href="http://www.cppblog.com/The-Moment/category/11275.html/rss"><img title="Subscribe to 杂记(3)" src="xml_001.gif" border="0"></a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">随笔档案</h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl01_Link" class="listitem" href="http://www.cppblog.com/The-Moment/archive/2009/07.html">2009年7月 (13)</a></li>
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl01_LinkList_ctl02_Link" class="listitem" href="http://www.cppblog.com/The-Moment/archive/2009/06.html">2009年6月 (16)</a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">文章分类</h1>
		
				<ul class="catList">
			
				<li class="catListItem"> <a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl01_Link" class="listitem" href="http://www.cppblog.com/The-Moment/category/10910.html">C\C++</a><a id="SingleColumn1_Categories_CatList_ctl02_LinkList_ctl01_RssLink" title="Subscribe to C\C++" class="listitem" href="http://www.cppblog.com/The-Moment/category/10910.html/rss"><img title="Subscribe to C\C++" src="xml_001.gif" border="0"></a></li>
			
				</ul>
			
	
		<h1 class="catListTitle">VC</h1>
		
				<ul class="catList">
			
				</ul>
			
	



<h3>搜索</h3>
<ul>
	<li>
		</li><li><input value="" style="width: 130px;" name="q" id="q" onkeydown="return SearchGoogle(document.getElementById('q'),event,'www.cppblog.com/The-Moment')" type="text">&nbsp;<input onclick="SearchGoogle(document.getElementById('q'),event,'www.cppblog.com/The-Moment')" value="搜索" name="sa" type="button">
	</li>
</ul>

<h3>最新评论
	<a id="SingleColumn1__dc7c32_RSSHyperlink1" href="http://www.cppblog.com/The-Moment/CommentsRSS.aspx"><img src="xml.gif" border="0"></a></h3>
<div class="RecentComment">
	
			<ul>
		
			<li style="">
				<a id="SingleColumn1__dc7c32_CommentList_ctl01_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2011/09/19/89050.html#156209">1.&nbsp;re: HexViewer[未登录]</a>
			</li>
			<li style="">
				eeeeeeee
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--a</li>
		
			<li style="">
				<a id="SingleColumn1__dc7c32_CommentList_ctl02_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2010/10/27/91639.html#131487">2.&nbsp;re: CSV逗号分隔值文件（Comma Separated value）</a>
			</li>
			<li style="">
				非常好。 
<br>可以发给我一份源码吗？ 
<br>我的email：mixed_now@163.com
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--mixed_now</li>
		
			<li style="">
				<a id="SingleColumn1__dc7c32_CommentList_ctl03_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2010/05/09/91639.html#114947">3.&nbsp;re: CSV逗号分隔值文件（Comma Separated value）</a>
			</li>
			<li style="">
				非常不错。
<br>可以发给我一份源码吗？
<br>我的email：dqf88@sohu.com
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--dqf</li>
		
			<li style="">
				<a id="SingleColumn1__dc7c32_CommentList_ctl04_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2010/05/07/87877.html#114723">4.&nbsp;re: 分解素因子</a>
			</li>
			<li style="">
				@The_Moment
<br>输出没有全部是素数
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--dsdsd</li>
		
			<li style="">
				<a id="SingleColumn1__dc7c32_CommentList_ctl05_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/09/07/87877.html#95441">5.&nbsp;re: 分解素因子</a>
			</li>
			<li style="">
				哪里错了啊？？！！@d
<br>
			</li>
			<li style="text-align: right; margin-right: 4px;">
				--The_Moment</li>
		
			</ul>
		
</div>

<h3>阅读排行榜</h3>
<div class="RecentComment">
	
			<ul style="">
		
			<li>
				<a id="SingleColumn1__33e63ac_TopList_ctl01_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/29/91556.aspx">1.&nbsp;C、C++和MFC中文件的读写方法(2085)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__33e63ac_TopList_ctl02_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/18/87953.aspx">2.&nbsp;std:string学习 (1303)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__33e63ac_TopList_ctl03_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/29/91639.aspx">3.&nbsp;CSV逗号分隔值文件（Comma Separated value）(1283)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__33e63ac_TopList_ctl04_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/17/87892.aspx">4.&nbsp;AppFace For VC （VC界面）(889)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__33e63ac_TopList_ctl05_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/18/88023.aspx">5.&nbsp;STL迭代器简介 (873)</a>
			</li>
		
			</ul>
		
</div>

<h3>评论排行榜</h3>
<div class="RecentComment">
	
			<ul style="">
		
			<li>
				<a id="SingleColumn1__281c14f_TopList_ctl01_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/17/87877.aspx">1.&nbsp;分解素因子(3)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__281c14f_TopList_ctl02_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/29/91639.aspx">2.&nbsp;CSV逗号分隔值文件（Comma Separated value）(2)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__281c14f_TopList_ctl03_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/02/89050.aspx">3.&nbsp;HexViewer(1)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__281c14f_TopList_ctl04_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/03/89146.aspx">4.&nbsp;Mouse(0)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__281c14f_TopList_ctl05_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/03/89189.aspx">5.&nbsp;进度条CProgressBar类(0)</a>
			</li>
		
			</ul>
		
</div>
</div>
	
</div>
<div id="centercontent">
	
					
<!--done-->
<div class="post">
	<div class="postTitle">
		<a name="baidusnap0"></a><a id="viewpost1_TitleUrl" class="postTitle2" href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.html"><b style="color: black; background-color: rgb(255, 255, 102);">Winsock详解</b></a>
	</div>
	<p>今天学习了些关于VC网络编程中关于Winsock的知识，并做了相应的整理。在这里根据了一个聊天室例子帮助我了解这些知识的用法。<br>（1）Server端调用函数顺序：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WSAStartup（）初始化Winsock<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket（）创建一个监听Socket<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bind（）为监听Socket指定通信对象<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listen（）设置等待连接状态<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accept（）接收连接并生成会话Socket<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send和recv进行对话<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket（）关闭socket<br>（2）Client端调用函数顺序<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WSAStartup（）初始化Winsock<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket（）创建一个监听Socket<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect（）与Server端连接<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send和recv进行对话<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket（）关闭socket<br>1、程序头部分，包括引用的头文件、宏定义、全局变量和函数声明</p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 0);">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">stdafx.h</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">resource.h</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">VECTOR</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">采用STL</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">algorithm</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">WINSOCK2.H</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">调用winsock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">#include&nbsp;</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">ASSERT.H</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">#define</span><span style="color: rgb(0, 0, 0);">&nbsp;BUFFER_SIZE&nbsp;4096&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">缓冲区的大小</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">#define</span><span style="color: rgb(0, 0, 0);">&nbsp;SERVER_MESSAGE&nbsp;WM_USER+100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">服务器SOCKET异步消息ID</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">#define</span><span style="color: rgb(0, 0, 0);">&nbsp;CLIENT_MESSAGE&nbsp;WM_USER+101&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">客户机SOCKET异步消息ID</span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;Global&nbsp;Variables:</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">SOCKET&nbsp;g_ListenSocket;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">Listen&nbsp;socket&nbsp;(for&nbsp;server)</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">std::vector</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">SOCKET</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;g_DataSockets;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">All&nbsp;data&nbsp;sockets&nbsp;with&nbsp;clients&nbsp;(for&nbsp;server)</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">SOCKET&nbsp;g_ClientSocket;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">Client&nbsp;data&nbsp;socket&nbsp;(for&nbsp;client)</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">BOOL&nbsp;g_bActive;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">A&nbsp;tag&nbsp;of&nbsp;active&nbsp;socket&nbsp;(for&nbsp;both&nbsp;server&nbsp;and&nbsp;client)</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);">std::</span><span style="color: rgb(0, 0, 255);">string</span><span style="color: rgb(0, 0, 0);">&nbsp;g_ChatWords;<br><img src="none.gif" align="top">BOOL&nbsp;g_bClient;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">TRUE&nbsp;as&nbsp;a&nbsp;client,&nbsp;FALSE&nbsp;as&nbsp;a&nbsp;server</span><span style="color: rgb(0, 128, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top">BOOL&nbsp;ServerInit(HWND&nbsp;hWnd,UINT&nbsp;port);<br><img src="none.gif" align="top">BOOL&nbsp;ClientInit(HWND&nbsp;hWnd,UINT&nbsp;port,</span><span style="color: rgb(0, 0, 255);">const</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">&nbsp;serverIP);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;OnClientMessage(HWND&nbsp;hWnd,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;OnServerMessage(HWND&nbsp;hWnd,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;SendMessageToPeer(HWND&nbsp;hWnd);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;Send(SOCKET&nbsp;sock,&nbsp;</span><span style="color: rgb(0, 0, 255);">const</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer,&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;length);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;RefreshScreen(HWND&nbsp;hWnd);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;ExitChat(HWND&nbsp;hWnd);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;GetErrorReason();</span></div>
2、Win32程序函数入口点WinMain：
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 0);">LRESULT&nbsp;CALLBACK&nbsp;&nbsp;&nbsp;&nbsp;WndProc(HWND,&nbsp;UINT,&nbsp;WPARAM,&nbsp;LPARAM);<br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;APIENTRY&nbsp;WinMain(HINSTANCE&nbsp;hInstance,<br><img src="none.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HINSTANCE&nbsp;hPrevInstance,<br><img src="none.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPSTR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lpCmdLine,<br><img src="none.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nCmdShow)<br><img id="Codehighlighter1_225_377_Open_Image" onclick="this.style.display='none'; Codehighlighter1_225_377_Open_Text.style.display='none'; Codehighlighter1_225_377_Closed_Image.style.display='inline'; Codehighlighter1_225_377_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_225_377_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_225_377_Closed_Text.style.display='none'; Codehighlighter1_225_377_Open_Image.style.display='inline'; Codehighlighter1_225_377_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_225_377_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_225_377_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;Perform&nbsp;application&nbsp;initialization:</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">FALSE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;DialogBox(hInstance,&nbsp;MAKEINTRESOURCE(IDD_CHAT_DIALOG),&nbsp;NULL,&nbsp;(DLGPROC)WndProc);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedblockend.gif" align="top">}</span></span></div>
3、对话框的消息循环函数WndProc：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 12pt; font-family: 宋体;">在</span><span style="font-size: 12pt;" lang="EN-US">WndProc</span><span style="font-size: 12pt; font-family: 宋体;">消息循环中，只处理</span><span style="font-size: 12pt;" lang="EN-US">4</span><span style="font-size: 12pt; font-family: 宋体;">中消息：对话框初始化、对话框控件、服务器</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">异步和客户端</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">异步，在对话框初始化中，程序启动了</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">栈。在对话框控件中，程序分别响应了各种按钮消息以及文字输入框消息</span><span style="font-size: 12pt;" lang="EN-US">EN_UPDATE</span><span style="font-size: 12pt; font-family: 宋体;">。在服务器</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">异步消息中，调用</span><span style="font-size: 12pt;" lang="EN-US">OnServerMessage</span><span style="font-size: 12pt; font-family: 宋体;">处理。在客户端</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">异步消息中，调用了</span><span style="font-size: 12pt;" lang="EN-US">OnclientMessage</span><span style="font-size: 12pt; font-family: 宋体;">处理。
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 0);">LRESULT&nbsp;CALLBACK&nbsp;WndProc(HWND&nbsp;hWnd,&nbsp;UINT&nbsp;message,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br><img id="Codehighlighter1_80_1406_Open_Image" onclick="this.style.display='none'; Codehighlighter1_80_1406_Open_Text.style.display='none'; Codehighlighter1_80_1406_Closed_Image.style.display='inline'; Codehighlighter1_80_1406_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_80_1406_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_80_1406_Closed_Text.style.display='none'; Codehighlighter1_80_1406_Open_Image.style.display='inline'; Codehighlighter1_80_1406_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_80_1406_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_80_1406_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;subWnd;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;UINT&nbsp;port;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;serverIP[</span><span style="color: rgb(0, 0, 0);">16</span><span style="color: rgb(0, 0, 0);">];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">switch</span><span style="color: rgb(0, 0, 0);">&nbsp;(message)<br><img id="Codehighlighter1_174_1393_Open_Image" onclick="this.style.display='none'; Codehighlighter1_174_1393_Open_Text.style.display='none'; Codehighlighter1_174_1393_Closed_Image.style.display='inline'; Codehighlighter1_174_1393_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_174_1393_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_174_1393_Closed_Text.style.display='none'; Codehighlighter1_174_1393_Open_Image.style.display='inline'; Codehighlighter1_174_1393_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_174_1393_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_174_1393_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;WM_INITDIALOG:<br><img id="Codehighlighter1_199_350_Open_Image" onclick="this.style.display='none'; Codehighlighter1_199_350_Open_Text.style.display='none'; Codehighlighter1_199_350_Closed_Image.style.display='inline'; Codehighlighter1_199_350_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_199_350_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_199_350_Closed_Text.style.display='none'; Codehighlighter1_199_350_Open_Image.style.display='inline'; Codehighlighter1_199_350_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_199_350_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_199_350_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WSADATA&nbsp;wsaData;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(WSAStartup(MAKEWORD(</span><span style="color: rgb(0, 0, 0);">2</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">2</span><span style="color: rgb(0, 0, 0);">),</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">wsaData)</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)<br><img id="Codehighlighter1_269_346_Open_Image" onclick="this.style.display='none'; Codehighlighter1_269_346_Open_Text.style.display='none'; Codehighlighter1_269_346_Closed_Image.style.display='inline'; Codehighlighter1_269_346_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_269_346_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_269_346_Closed_Text.style.display='none'; Codehighlighter1_269_346_Open_Image.style.display='inline'; Codehighlighter1_269_346_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_269_346_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_269_346_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(hWnd,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Socket&nbsp;Stack&nbsp;Error!</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Error</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,IDOK);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">-</span><span style="color: rgb(0, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;TRUE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;WM_COMMAND:<br><img id="Codehighlighter1_387_1220_Open_Image" onclick="this.style.display='none'; Codehighlighter1_387_1220_Open_Text.style.display='none'; Codehighlighter1_387_1220_Closed_Image.style.display='inline'; Codehighlighter1_387_1220_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_387_1220_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_387_1220_Closed_Text.style.display='none'; Codehighlighter1_387_1220_Open_Image.style.display='inline'; Codehighlighter1_387_1220_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_387_1220_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_387_1220_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">switch</span><span style="color: rgb(0, 0, 0);">(LOWORD(wParam))<br><img id="Codehighlighter1_418_1216_Open_Image" onclick="this.style.display='none'; Codehighlighter1_418_1216_Open_Text.style.display='none'; Codehighlighter1_418_1216_Closed_Image.style.display='inline'; Codehighlighter1_418_1216_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_418_1216_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_418_1216_Closed_Text.style.display='none'; Codehighlighter1_418_1216_Open_Image.style.display='inline'; Codehighlighter1_418_1216_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_418_1216_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_418_1216_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;IDOK:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;IDCANCEL:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndDialog(hWnd,LOWORD(wParam));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;IDC_CONNECT:<br><img id="Codehighlighter1_524_841_Open_Image" onclick="this.style.display='none'; Codehighlighter1_524_841_Open_Text.style.display='none'; Codehighlighter1_524_841_Closed_Image.style.display='inline'; Codehighlighter1_524_841_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_524_841_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_524_841_Closed_Text.style.display='none'; Codehighlighter1_524_841_Open_Image.style.display='inline'; Codehighlighter1_524_841_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_524_841_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_524_841_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subWnd</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">GetDlgItem(hWnd,IDC_LISTEN_PORT_C);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(subWnd,buffer,&nbsp;BUFFER_SIZE);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;UINT(atoi(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subWnd</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">GetDlgItem(hWnd,IDC_SERVERIP);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(subWnd,buffer,BUFFER_SIZE);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strncpy(serverIP,buffer,</span><span style="color: rgb(0, 0, 0);">16</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClientInit(hWnd,port,serverIP);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">g_ChatWords="";</span><span style="color: rgb(0, 128, 0);"><br><img src="expandedsubblockend.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;IDC_LISTEN:<br><img id="Codehighlighter1_878_1062_Open_Image" onclick="this.style.display='none'; Codehighlighter1_878_1062_Open_Text.style.display='none'; Codehighlighter1_878_1062_Closed_Image.style.display='inline'; Codehighlighter1_878_1062_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_878_1062_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_878_1062_Closed_Text.style.display='none'; Codehighlighter1_878_1062_Open_Image.style.display='inline'; Codehighlighter1_878_1062_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_878_1062_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_878_1062_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subWnd</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">GetDlgItem(hWnd,IDC_LISTEN_PORT_S);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(subWnd,buffer,&nbsp;BUFFER_SIZE);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;UINT(atoi(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ServerInit(hWnd,port);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">g_ChatWords="";</span><span style="color: rgb(0, 128, 0);"><br><img src="expandedsubblockend.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;IDC_INPUTTEXT:<br><img id="Codehighlighter1_1102_1188_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1102_1188_Open_Text.style.display='none'; Codehighlighter1_1102_1188_Closed_Image.style.display='inline'; Codehighlighter1_1102_1188_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1102_1188_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1102_1188_Closed_Text.style.display='none'; Codehighlighter1_1102_1188_Open_Image.style.display='inline'; Codehighlighter1_1102_1188_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1102_1188_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1102_1188_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(HIWORD(wParam)</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">EN_UPDATE)<br><img id="Codehighlighter1_1144_1182_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1144_1182_Open_Text.style.display='none'; Codehighlighter1_1144_1182_Closed_Image.style.display='inline'; Codehighlighter1_1144_1182_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1144_1182_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1144_1182_Closed_Text.style.display='none'; Codehighlighter1_1144_1182_Open_Image.style.display='inline'; Codehighlighter1_1144_1182_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1144_1182_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1144_1182_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SendMessageToPeer(hWnd);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">default</span><span style="color: rgb(0, 0, 0);">:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;SERVER_MESSAGE:<br><img id="Codehighlighter1_1255_1300_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1255_1300_Open_Text.style.display='none'; Codehighlighter1_1255_1300_Closed_Image.style.display='inline'; Codehighlighter1_1255_1300_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1255_1300_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1255_1300_Closed_Text.style.display='none'; Codehighlighter1_1255_1300_Open_Image.style.display='inline'; Codehighlighter1_1255_1300_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1255_1300_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1255_1300_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnServerMessage(hWnd,wParam,&nbsp;lParam);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;CLIENT_MESSAGE:<br><img id="Codehighlighter1_1335_1381_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1335_1381_Open_Text.style.display='none'; Codehighlighter1_1335_1381_Closed_Image.style.display='inline'; Codehighlighter1_1335_1381_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1335_1381_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1335_1381_Closed_Text.style.display='none'; Codehighlighter1_1335_1381_Open_Image.style.display='inline'; Codehighlighter1_1335_1381_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1335_1381_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1335_1381_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnClientMessage(hWnd,&nbsp;wParam,&nbsp;lParam);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span></div>
</span><span style="font-size: 12pt;" lang="EN-US"><o:p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US">1)int WSAStartup(WORD wVersionRequested,LPWSADATA lpWSAData);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 12pt;" lang="EN-US">wVersionRequested</span><span style="font-size: 12pt; font-family: 宋体;">：表示欲使用的</span><span style="font-size: 12pt;" lang="EN-US">Windows Sockets API</span><span style="font-size: 12pt; font-family: 宋体;">版本，使用宏</span><span style="font-size: 12pt;" lang="EN-US">MAKEWORD</span><span style="font-size: 12pt; font-family: 宋体;">（</span><span style="font-size: 12pt;" lang="EN-US">X</span><span style="font-size: 12pt; font-family: 宋体;">，</span><span style="font-size: 12pt;" lang="EN-US">Y</span><span style="font-size: 12pt; font-family: 宋体;">）设置参数。表示版本为</span><span style="font-size: 12pt;" lang="EN-US">X.Y(本例中为2.2)<br><o:p>4、客户端初始化函数ClientInit：<br></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; font-family: 宋体;">&nbsp;&nbsp;&nbsp;当单击“连接服务器“按钮时，程序分别从子窗口</span><span style="font-size: 12pt;" lang="EN-US">IDC_LISTEN_POST_C</span><span style="font-size: 12pt; font-family: 宋体;">和</span><span style="font-size: 12pt;" lang="EN-US">IDC_SERVERIP</span><span style="font-size: 12pt; font-family: 宋体;">中提取服务器的</span><span style="font-size: 12pt;" lang="EN-US">IP</span><span style="font-size: 12pt; font-family: 宋体;">和监听端口，然后调用客户端函数</span><span style="font-size: 12pt;" lang="EN-US">ClientInit</span><span style="font-size: 12pt; font-family: 宋体;">。</span></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 0);">BOOL&nbsp;ClientInit(HWND&nbsp;hWnd,UINT&nbsp;port,</span><span style="color: rgb(0, 0, 255);">const</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">&nbsp;serverIP)<br><img id="Codehighlighter1_58_923_Open_Image" onclick="this.style.display='none'; Codehighlighter1_58_923_Open_Text.style.display='none'; Codehighlighter1_58_923_Closed_Image.style.display='inline'; Codehighlighter1_58_923_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_58_923_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_58_923_Closed_Text.style.display='none'; Codehighlighter1_58_923_Open_Image.style.display='inline'; Codehighlighter1_58_923_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_58_923_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_58_923_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;sockaddr_in&nbsp;addr;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;ExitChat(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_bClient</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">TRUE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(inet_addr(serverIP)</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">INADDR_NONE)<br><img id="Codehighlighter1_152_229_Open_Image" onclick="this.style.display='none'; Codehighlighter1_152_229_Open_Text.style.display='none'; Codehighlighter1_152_229_Closed_Image.style.display='inline'; Codehighlighter1_152_229_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_152_229_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_152_229_Closed_Text.style.display='none'; Codehighlighter1_152_229_Open_Image.style.display='inline'; Codehighlighter1_152_229_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_152_229_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_152_229_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(hWnd,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Invalid&nbsp;IP&nbsp;Address!</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Warnning</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,IDOK);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;FALSE;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">create&nbsp;tcp/stream&nbsp;data&nbsp;socket</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;g_ClientSocket&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;socket(AF_INET,&nbsp;SOCK_STREAM,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;assert(g_ClientSocket&nbsp;</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">&nbsp;INVALID_SOCKET);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">set&nbsp;the&nbsp;socket&nbsp;as&nbsp;async&nbsp;selection&nbsp;tag,&nbsp;the&nbsp;related&nbsp;message&nbsp;is&nbsp;CLIENT_MESSAGE<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">the&nbsp;async&nbsp;events&nbsp;contain:&nbsp;read,&nbsp;write,&nbsp;close,&nbsp;connect</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;WSAAsyncSelect(g_ClientSocket,hWnd,CLIENT_MESSAGE,FD_READ</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_WRITE</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_CLOSE</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_CONNECT);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">set&nbsp;the&nbsp;server&nbsp;address&nbsp;and&nbsp;port</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_family&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;AF_INET;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_addr.S_un.S_addr&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;inet_addr(serverIP);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_port&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;htons(port);&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">short&nbsp;from&nbsp;host&nbsp;to&nbsp;network&nbsp;format<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">connect&nbsp;to&nbsp;server</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;connect(g_ClientSocket,&nbsp;(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">addr,&nbsp;</span><span style="color: rgb(0, 0, 255);">sizeof</span><span style="color: rgb(0, 0, 0);">(addr));<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Connecting<img src="dot.gif">\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;TRUE;<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span></div>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">1</font></span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCKET socket(int af,int type,int protocol);<o:p></o:p></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>af</font></span><span style="font-size: 12pt; font-family: 宋体;">：指协议的地址族，如果想建立一个</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">UDP</font></span><span style="font-size: 12pt; font-family: 宋体;">或</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">TCP</font></span><span style="font-size: 12pt; font-family: 宋体;">的套接字，则该值设置成</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">AF_INET</font></span><span style="font-size: 12pt; font-family: 宋体;">，表示在网络层采用网际协议（</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">IP</font></span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>type</font></span><span style="font-size: 12pt; font-family: 宋体;">：协议的套接字类型，可以是</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_STREAM</font></span><span style="font-size: 12pt; font-family: 宋体;">、</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_DGRAM </font></span><span style="font-size: 12pt; font-family: 宋体;">、</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_RAW</font></span><span style="font-size: 12pt; font-family: 宋体;">、</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_RDM</font></span><span style="font-size: 12pt; font-family: 宋体;">、</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_SEQPACKET</font></span><span style="font-size: 12pt; font-family: 宋体;">。</span><span style="font-size: 12pt;"><font face="Times New Roman"> </font></span><span style="font-size: 12pt; font-family: 宋体;">当采用流连接方式时用</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_STREAM</font></span><span style="font-size: 12pt; font-family: 宋体;">，采用数据报文方式用</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">SOCK_DGRAM<o:p></o:p></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>proctocol</font></span><span style="font-size: 12pt; font-family: 宋体;">：协议字段，当</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">af</font></span><span style="font-size: 12pt; font-family: 宋体;">和</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">type</font></span><span style="font-size: 12pt; font-family: 宋体;">都指定之后，该值的取值范围就被去定了，默认值为</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">0</font></span><span style="font-size: 12pt; font-family: 宋体;">。</span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">2</font></span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">int PASCAL FAR WSAAsyncSelect ( SOCKET s, HWND hWnd, unsigned int wMsg, long lEvent );<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">S</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：标识一个需要事件通知的套接口的描述符</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">.<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">hWnd</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：标识一个在网络事件发生时需要接收消息的窗口句柄</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">.<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">wMsg </span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：在网络事件发生时要接收的消息</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">.<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 21pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">lEvent</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：位屏蔽码</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">,</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">用于指明应用程序感兴趣的网络事件集合</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">.<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">3</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">int connect(SOCKET s,const struct sockaddr FAR * name,int namelen);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>S</font></span><span style="font-size: 12pt; font-family: 宋体;">是建立好的套接字，</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">name</font></span><span style="font-size: 12pt; font-family: 宋体;">指向描述通信对象地址信息的结构体的指针，</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">namelen</font></span><span style="font-size: 12pt; font-family: 宋体;">是该结构体的长度。</span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">4</font></span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">struct sockaddr_in {short sin_family;u_short sin_port;struct in_addr sin_addr;char<span style="">&nbsp;&nbsp;&nbsp; </span>sin_zero[8];};<o:p></o:p></font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt;"><span style="font-size: 12pt;" lang="EN-US"><font face="Times New Roman">5</font></span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">unsigned long PASCAL FAR inet_addr( const struct FAR* cp);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">　　</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">cp</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：一个以</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">Internet</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">标准</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">“.”</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">间隔的字符串。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 24.75pt;"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">本函数解释</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">cp</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">参数中的字符串，这个字符串用</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">Internet</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">“.”</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">间隔格式表示一个数字的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">Internet</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">地址。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">6</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">u_short PASCAL FAR htons( u_short hostshort);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">　　</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">hostshort</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：主机字节顺序表达的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">16</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">位数。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">　　本函数将一个</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">16</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">位数从主机字节顺序转换成网络字节顺序。</span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US"><span style="">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="font-size: 12pt; font-family: 宋体;">其中</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">sin_family</span><span style="font-size: 12pt; font-family: 宋体;">是指地址族；</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">sin_port</span><span style="font-size: 12pt; font-family: 宋体;">是制定的端口号；</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">sin_addr</span><span style="font-size: 12pt; font-family: 宋体;">是制定的</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">IP</span><span style="font-size: 12pt; font-family: 宋体;">地址；</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">sin_zero</span><span style="font-size: 12pt; font-family: 宋体;">冗余字段，使</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">sockaddr_in</span><span style="font-size: 12pt; font-family: 宋体;">结构和</span><span style="font-size: 12pt; font-family: 'Times New Roman';" lang="EN-US">SOCKADDR</span><span style="font-size: 12pt; font-family: 宋体;">结构大小相同</span><br>5、服务器初始化函数ServerInit：<br><span style="font-family: 宋体;">&nbsp;&nbsp;&nbsp;单击“建立服务器“按钮时，程序从子窗口</span><span lang="EN-US"><font face="Times New Roman">IDC_LISTEN_PORT_S</font></span><span style="font-family: 宋体;">中提取监听端口，然后调用服务器初始化函数</span><span lang="EN-US"><font face="Times New Roman">ServerInit</font></span><span style="font-family: 宋体;">。</span></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 0);">BOOL&nbsp;ServerInit(HWND&nbsp;hWnd,UINT&nbsp;port)<br><img id="Codehighlighter1_37_1289_Open_Image" onclick="this.style.display='none'; Codehighlighter1_37_1289_Open_Text.style.display='none'; Codehighlighter1_37_1289_Closed_Image.style.display='inline'; Codehighlighter1_37_1289_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_37_1289_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_37_1289_Closed_Text.style.display='none'; Codehighlighter1_37_1289_Open_Image.style.display='inline'; Codehighlighter1_37_1289_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_37_1289_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_37_1289_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;sockaddr_in&nbsp;addr;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;ExitChat(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_bClient</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">FALSE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">create&nbsp;a&nbsp;tcp/stream&nbsp;based&nbsp;socket</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;g_ListenSocket&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;socket(AF_INET,&nbsp;SOCK_STREAM,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;assert(g_ListenSocket&nbsp;</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">&nbsp;INVALID_SOCKET);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">set&nbsp;the&nbsp;socket&nbsp;as&nbsp;async&nbsp;selection&nbsp;tag,&nbsp;the&nbsp;related&nbsp;message&nbsp;is&nbsp;SERVER_MESSAGE<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">the&nbsp;async&nbsp;events&nbsp;contain:&nbsp;accept,&nbsp;read,&nbsp;write,&nbsp;close</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;WSAAsyncSelect(g_ListenSocket,&nbsp;hWnd,&nbsp;SERVER_MESSAGE,&nbsp;FD_ACCEPT</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_READ</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_WRITE</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FD_CLOSE);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_family&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;AF_INET;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">IP&nbsp;layer&nbsp;takes&nbsp;IP&nbsp;router&nbsp;protocol</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_addr.S_un.S_addr&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;INADDR_ANY;&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;addr.sin_port&nbsp;</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;htons(port);</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">port&nbsp;from&nbsp;short&nbsp;of&nbsp;host&nbsp;to&nbsp;short&nbsp;of&nbsp;network<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">binding&nbsp;listening&nbsp;socket</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(bind(g_ListenSocket,&nbsp;(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">addr,&nbsp;</span><span style="color: rgb(0, 0, 255);">sizeof</span><span style="color: rgb(0, 0, 0);">(sockaddr))&nbsp;</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;SOCKET_ERROR)<br><img id="Codehighlighter1_771_965_Open_Image" onclick="this.style.display='none'; Codehighlighter1_771_965_Open_Text.style.display='none'; Codehighlighter1_771_965_Closed_Image.style.display='inline'; Codehighlighter1_771_965_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_771_965_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_771_965_Closed_Text.style.display='none'; Codehighlighter1_771_965_Open_Image.style.display='inline'; Codehighlighter1_771_965_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_771_965_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_771_965_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Port&nbsp;%d&nbsp;has&nbsp;been&nbsp;taken.&nbsp;Change&nbsp;another&nbsp;port.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,port);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(hWnd,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Binding&nbsp;Error</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Warnning</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,IDOK);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;FALSE;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">listening</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(listen(g_ListenSocket,&nbsp;</span><span style="color: rgb(0, 0, 0);">5</span><span style="color: rgb(0, 0, 0);">)&nbsp;</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;SOCKET_ERROR)<br><img id="Codehighlighter1_1030_1187_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1030_1187_Open_Text.style.display='none'; Codehighlighter1_1030_1187_Closed_Image.style.display='inline'; Codehighlighter1_1030_1187_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1030_1187_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1030_1187_Closed_Text.style.display='none'; Codehighlighter1_1030_1187_Open_Image.style.display='inline'; Codehighlighter1_1030_1187_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1030_1187_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1030_1187_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Listen&nbsp;error.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(hWnd,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Listen&nbsp;Error.</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Warnning</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,IDOK);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;FALSE;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Server&nbsp;is&nbsp;listening<img src="dot.gif">\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">TRUE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;TRUE;<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span></div>
</o:p></span><span lang="EN-US">
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;"><span style="" lang="EN-US"><span style="">1）<span style="font: 7pt 'Times New Roman';">&nbsp; </span></span></span><span lang="EN-US">int bind(SOCKET s,const struct sockaddr FAR * name,int namelen);</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt;"><span style="font-size: 12pt;" lang="EN-US">S</span><span style="font-size: 12pt; font-family: 宋体;">是建立好的套接字，</span><span style="font-size: 12pt;" lang="EN-US">name</span><span style="font-size: 12pt; font-family: 宋体;">指向描述通信对象地址信息的结构体的指针，</span><span style="font-size: 12pt;" lang="EN-US">namelen</span><span style="font-size: 12pt; font-family: 宋体;">是该结构体的长度。</span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;"><span style="font-size: 12pt;" lang="EN-US"><span style="">2）</span></span><span style="font-size: 12pt;" lang="EN-US">int listen(SOCKET s,int backlog);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt;"><span style="font-size: 12pt;" lang="EN-US">S</span><span style="font-size: 12pt; font-family: 宋体;">是建立好的套接字，</span><span style="font-size: 12pt;" lang="EN-US">backlog</span><span style="font-size: 12pt; font-family: 宋体;">是并发连接等待队列的长度。<br></span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; font-family: 宋体;">6、SendMessageToPeer函数：<br>&nbsp;&nbsp;&nbsp;当用户在文本框中输入文字时，程序会接收到该文本框的</span><span style="font-size: 12pt;" lang="EN-US">EN_UPDATE</span><span style="font-size: 12pt; font-family: 宋体;">消息，函数</span><span style="font-size: 12pt;" lang="EN-US">SendMessageToPeer</span><span style="font-size: 12pt; font-family: 宋体;">负责处理该消息。在</span><span style="font-size: 12pt;" lang="EN-US">SendMessageToPeer</span><span style="font-size: 12pt; font-family: 宋体;">中，一旦检测到用户按下了回车键，程序就将文本内容刷新到上面的显示框中，如果当前在线，文本内容还将发送到会话的另一端。</span></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;SendMessageToPeer(HWND&nbsp;hWnd)<br><img id="Codehighlighter1_34_857_Open_Image" onclick="this.style.display='none'; Codehighlighter1_34_857_Open_Text.style.display='none'; Codehighlighter1_34_857_Closed_Image.style.display='inline'; Codehighlighter1_34_857_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_34_857_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_34_857_Closed_Text.style.display='none'; Codehighlighter1_34_857_Open_Image.style.display='inline'; Codehighlighter1_34_857_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_34_857_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_34_857_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;subwnd;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;i;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">static</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;oldNumOfChars</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;subwnd</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">GetDlgItem(hWnd,IDC_INPUTTEXT);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;GetWindowText(subwnd,buffer,BUFFER_SIZE</span><span style="color: rgb(0, 0, 0);">-</span><span style="color: rgb(0, 0, 0);">2</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(oldNumOfChars</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">strlen(buffer))<br><img id="Codehighlighter1_236_281_Open_Image" onclick="this.style.display='none'; Codehighlighter1_236_281_Open_Text.style.display='none'; Codehighlighter1_236_281_Closed_Image.style.display='inline'; Codehighlighter1_236_281_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_236_281_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_236_281_Closed_Text.style.display='none'; Codehighlighter1_236_281_Open_Image.style.display='inline'; Codehighlighter1_236_281_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_236_281_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_236_281_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldNumOfChars</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">strlen(buffer);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">CString&nbsp;s;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">s("%d还是%d",oldNumOfChars,strlen(buffer));<br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords+=s;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">empty&nbsp;content&nbsp;of&nbsp;input&nbsp;edit&nbsp;box</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(subwnd,</span><span style="color: rgb(0, 0, 0);">""</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;oldNumOfChars</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">!</span><span style="color: rgb(0, 0, 0);">g_bActive)<br><img id="Codehighlighter1_461_617_Open_Image" onclick="this.style.display='none'; Codehighlighter1_461_617_Open_Text.style.display='none'; Codehighlighter1_461_617_Closed_Image.style.display='inline'; Codehighlighter1_461_617_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_461_617_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_461_617_Closed_Text.style.display='none'; Codehighlighter1_461_617_Open_Image.style.display='inline'; Codehighlighter1_461_617_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_461_617_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_461_617_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords.erase(g_ChatWords.size(),</span><span style="color: rgb(0, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">(Hint:&nbsp;you&nbsp;are&nbsp;isolated&nbsp;now.)\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;strcat(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(g_bClient)<br><img id="Codehighlighter1_705_756_Open_Image" onclick="this.style.display='none'; Codehighlighter1_705_756_Open_Text.style.display='none'; Codehighlighter1_705_756_Closed_Image.style.display='inline'; Codehighlighter1_705_756_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_705_756_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_705_756_Closed_Text.style.display='none'; Codehighlighter1_705_756_Open_Image.style.display='inline'; Codehighlighter1_705_756_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_705_756_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_705_756_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_ClientSocket,&nbsp;buffer,&nbsp;strlen(buffer));<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">else</span><span style="color: rgb(0, 0, 0);"><br><img id="Codehighlighter1_765_855_Open_Image" onclick="this.style.display='none'; Codehighlighter1_765_855_Open_Text.style.display='none'; Codehighlighter1_765_855_Closed_Image.style.display='inline'; Codehighlighter1_765_855_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_765_855_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_765_855_Closed_Text.style.display='none'; Codehighlighter1_765_855_Open_Image.style.display='inline'; Codehighlighter1_765_855_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_765_855_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_765_855_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedblockend.gif" align="top">}</span></span></div>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;Send(SOCKET&nbsp;sock,&nbsp;</span><span style="color: rgb(0, 0, 255);">const</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer,&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;length)<br><img id="Codehighlighter1_55_275_Open_Image" onclick="this.style.display='none'; Codehighlighter1_55_275_Open_Text.style.display='none'; Codehighlighter1_55_275_Closed_Image.style.display='inline'; Codehighlighter1_55_275_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_55_275_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_55_275_Closed_Text.style.display='none'; Codehighlighter1_55_275_Open_Image.style.display='inline'; Codehighlighter1_55_275_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_55_275_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_55_275_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;ret,i;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">while</span><span style="color: rgb(0, 0, 0);">(length</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)<br><img id="Codehighlighter1_93_273_Open_Image" onclick="this.style.display='none'; Codehighlighter1_93_273_Open_Text.style.display='none'; Codehighlighter1_93_273_Closed_Image.style.display='inline'; Codehighlighter1_93_273_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_93_273_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_93_273_Closed_Text.style.display='none'; Codehighlighter1_93_273_Open_Image.style.display='inline'; Codehighlighter1_93_273_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_93_273_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_93_273_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">send(sock,</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">(buffer[i]),length,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(ret</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">)<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(ret&nbsp;</span><span style="color: rgb(0, 0, 0);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;SOCKET_ERROR)<br><img id="Codehighlighter1_191_245_Open_Image" onclick="this.style.display='none'; Codehighlighter1_191_245_Open_Text.style.display='none'; Codehighlighter1_191_245_Closed_Image.style.display='inline'; Codehighlighter1_191_245_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_191_245_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_191_245_Closed_Text.style.display='none'; Codehighlighter1_191_245_Open_Image.style.display='inline'; Codehighlighter1_191_245_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_191_245_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_191_245_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Error&nbsp;sending.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length</span><span style="color: rgb(0, 0, 0);">-=</span><span style="color: rgb(0, 0, 0);">ret;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">ret;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedblockend.gif" align="top">}</span></span></div>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;"><span style="font-size: 12pt;" lang="EN-US"><span style="">1）</span></span><span style="font-size: 12pt;" lang="EN-US">int send(SOCKET s,const char FAR * buf,int len,int flags);<br></span><span style="font-size: 12pt; font-family: 宋体;">参数</span><span style="font-size: 12pt;" lang="EN-US">s</span><span style="font-size: 12pt; font-family: 宋体;">是建立连接的套接字。</span><span style="font-size: 12pt;" lang="EN-US">buf</span><span style="font-size: 12pt; font-family: 宋体;">和</span><span style="font-size: 12pt;" lang="EN-US">len</span><span style="font-size: 12pt; font-family: 宋体;">是发送的数据包及其长度。</span><span style="font-size: 12pt;" lang="EN-US">flags</span><span style="font-size: 12pt; font-family: 宋体;">一般取</span><span style="font-size: 12pt;" lang="EN-US">0</span><span style="font-size: 12pt; font-family: 宋体;">，还有</span><span style="font-size: 12pt;" lang="EN-US">MSG_DONTROUTE</span><span style="font-size: 12pt; font-family: 宋体;">要求套接字传输的数据不要路由，如果传输协议不支持该选项，则这个要求被忽略。</span><span style="font-size: 12pt;" lang="EN-US">MSG_OOB</span><span style="font-size: 12pt; font-family: 宋体;">表示套接字此时传输的数据室外带数据，需要紧急处理。<br></span><span style="font-size: 12pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;">7、OnClientMessage函数：<br></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 12pt; font-family: 宋体;">在主循环的消息循环中，</span><span style="font-size: 12pt;" lang="EN-US">OnClientMessage</span><span style="font-size: 12pt; font-family: 宋体;">函数用来处理客户端</span><span style="font-size: 12pt;" lang="EN-US">SOCKET</span><span style="font-size: 12pt; font-family: 宋体;">的一部消息</span><span style="font-size: 12pt;" lang="EN-US">CLIENT_MESSAGE</span><span style="font-size: 12pt; font-family: 宋体;">。需要指出的是：当某个网络消息到达窗口时，可能暗含着套接字上发生了某种网络错误。此时，应该先判断套接字上是否发生了错误，如果有错误发生就直接关闭套接字然后返回，只有在没有错误发生的情况下，才需要处理具体的网络消息。在实现上，需要利用消息参数</span><span style="font-size: 12pt;" lang="EN-US">lParam</span><span style="font-size: 12pt; font-family: 宋体;">的高字节，宏</span><span style="font-size: 12pt;" lang="EN-US">WSAGETSELECTERROR</span><span style="font-size: 12pt; font-family: 宋体;">可以检测错误。而具体的消息类型是存储在</span><span style="font-size: 12pt;" lang="EN-US">lParam</span><span style="font-size: 12pt; font-family: 宋体;">的低字节，宏</span><span style="font-size: 12pt;" lang="EN-US">WSAGETSELECTEVENT</span><span style="font-size: 12pt; font-family: 宋体;">用来获取该低字节值。</span></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;OnClientMessage(HWND&nbsp;hWnd,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br><img id="Codehighlighter1_61_1117_Open_Image" onclick="this.style.display='none'; Codehighlighter1_61_1117_Open_Text.style.display='none'; Codehighlighter1_61_1117_Closed_Image.style.display='inline'; Codehighlighter1_61_1117_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_61_1117_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_61_1117_Closed_Text.style.display='none'; Codehighlighter1_61_1117_Open_Image.style.display='inline'; Codehighlighter1_61_1117_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_61_1117_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_61_1117_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;retCode;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;sockaddr_in&nbsp;name;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;namelen</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 255);">sizeof</span><span style="color: rgb(0, 0, 0);">(sockaddr_in);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(WSAGETSELECTERROR(lParam))<br><img id="Codehighlighter1_192_353_Open_Image" onclick="this.style.display='none'; Codehighlighter1_192_353_Open_Text.style.display='none'; Codehighlighter1_192_353_Closed_Image.style.display='inline'; Codehighlighter1_192_353_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_192_353_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_192_353_Closed_Text.style.display='none'; Codehighlighter1_192_353_Open_Image.style.display='inline'; Codehighlighter1_192_353_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_192_353_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_192_353_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket(g_ClientSocket);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Server&nbsp;has&nbsp;no&nbsp;response.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">FALSE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">switch</span><span style="color: rgb(0, 0, 0);">(WSAGETSELECTEVENT(lParam))<br><img id="Codehighlighter1_392_1104_Open_Image" onclick="this.style.display='none'; Codehighlighter1_392_1104_Open_Text.style.display='none'; Codehighlighter1_392_1104_Closed_Image.style.display='inline'; Codehighlighter1_392_1104_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_392_1104_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_392_1104_Closed_Text.style.display='none'; Codehighlighter1_392_1104_Open_Image.style.display='inline'; Codehighlighter1_392_1104_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_392_1104_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_392_1104_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_CONNECT:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getpeername(g_ClientSocket,(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">name,</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">namelen);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Successfully&nbsp;connected&nbsp;to&nbsp;%s:%d.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,inet_ntoa(name.sin_addr),ntohs(name.sin_port));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">TRUE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_READ:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retCode</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">recv(g_ClientSocket,buffer,BUFFER_SIZE,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(retCode</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">SOCKET_ERROR)<br><img id="Codehighlighter1_757_813_Open_Image" onclick="this.style.display='none'; Codehighlighter1_757_813_Open_Text.style.display='none'; Codehighlighter1_757_813_Closed_Image.style.display='inline'; Codehighlighter1_757_813_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_757_813_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_757_813_Closed_Text.style.display='none'; Codehighlighter1_757_813_Open_Image.style.display='inline'; Codehighlighter1_757_813_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_757_813_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_757_813_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer[retCode]</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">NULL;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">else</span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetErrorReason();<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_WRITE:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_CLOSE:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket(g_ClientSocket);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Server&nbsp;close&nbsp;session.Successfully&nbsp;log&nbsp;out.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">FALSE;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedblockend.gif" align="top">}</span></span></div>
</span>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt;"><span style="font-size: 12pt;" lang="EN-US">1</span><span style="font-size: 12pt; font-family: 宋体;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">char FAR* PASCAL FAR inet_ntoa( struct in_addr in);<br></span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：一个表示</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">Internet</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">主机地址的结构。<br>&nbsp;&nbsp;&nbsp;</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">本函数将一个用</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">in</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">参数所表示的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">Internet</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">地址结构转换成以</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">“.” </span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">间隔的诸如</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">“a.b.c.d”</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">的字符串形式。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><span style="">2）<span style="font: 7pt 'Times New Roman';"> </span></span></span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">int recv(SOCKET s,char FAR * buf,int len,int flags);<br></span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">参数与</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">send</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">一致</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt 18pt; text-indent: -18pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><span style="">3）</span></span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">int closesocket(SOCKET s);<br></span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">关闭套接字</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
8、OnServerMessage函数：<br>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">在主程序的消息循环中，</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">OnServerMessage</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">函数用来处理客户端</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">SOCKET</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">的一部消息</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">SERVER_MESSAGE</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">。在服务器初始化函数中的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">g_ListenSocket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">被设置成异步监听</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">，所有被</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">g_ListenSocket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">接收的数据</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">将同时被设置成异步</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">，并共享同一个消息</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">SERVER_MESSAGE</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">。及时服务器关闭了监听</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">，会话</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">的连接依然有效，除非服务器同时也将会话</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">socket</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">关闭。</span></p>
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;OnServerMessage(HWND&nbsp;hWnd,&nbsp;WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br><img id="Codehighlighter1_61_2877_Open_Image" onclick="this.style.display='none'; Codehighlighter1_61_2877_Open_Text.style.display='none'; Codehighlighter1_61_2877_Closed_Image.style.display='inline'; Codehighlighter1_61_2877_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_61_2877_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_61_2877_Closed_Text.style.display='none'; Codehighlighter1_61_2877_Open_Image.style.display='inline'; Codehighlighter1_61_2877_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_61_2877_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_61_2877_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;SOCKET&nbsp;socket;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;i,retCode,namelen;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE</span><span style="color: rgb(0, 0, 0);">+</span><span style="color: rgb(0, 0, 0);">1</span><span style="color: rgb(0, 0, 0);">];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;std::vector</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">SOCKET</span><span style="color: rgb(0, 0, 0);">&gt;</span><span style="color: rgb(0, 0, 0);">::iterator&nbsp;ite;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;sockaddr_in&nbsp;name;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;namelen</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 255);">sizeof</span><span style="color: rgb(0, 0, 0);">(name);<br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(WSAGETSELECTERROR(lParam))<br><img id="Codehighlighter1_243_801_Open_Image" onclick="this.style.display='none'; Codehighlighter1_243_801_Open_Text.style.display='none'; Codehighlighter1_243_801_Closed_Image.style.display='inline'; Codehighlighter1_243_801_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_243_801_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_243_801_Closed_Text.style.display='none'; Codehighlighter1_243_801_Open_Image.style.display='inline'; Codehighlighter1_243_801_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_243_801_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_243_801_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getpeername((SOCKET)wParam,(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">name,</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">namelen);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket((SOCKET)wParam);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">erase&nbsp;the&nbsp;client&nbsp;socket&nbsp;from&nbsp;client&nbsp;socks&nbsp;list</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ite</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">std::find(g_DataSockets.begin(),&nbsp;g_DataSockets.end(),(SOCKET)wParam);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(ite</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">g_DataSockets.end());<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_DataSockets.erase(ite);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">refresh&nbsp;screen</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,&nbsp;</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Client&nbsp;%s:%d&nbsp;lost&nbsp;contact&nbsp;with&nbsp;us.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,&nbsp;inet_ntoa(name.sin_addr),ntohs(name.sin_port));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;&nbsp;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();&nbsp;i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">switch</span><span style="color: rgb(0, 0, 0);">(WSAGETSELECTEVENT(lParam))<br><img id="Codehighlighter1_840_2864_Open_Image" onclick="this.style.display='none'; Codehighlighter1_840_2864_Open_Text.style.display='none'; Codehighlighter1_840_2864_Closed_Image.style.display='inline'; Codehighlighter1_840_2864_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_840_2864_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_840_2864_Closed_Text.style.display='none'; Codehighlighter1_840_2864_Open_Image.style.display='inline'; Codehighlighter1_840_2864_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_840_2864_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_840_2864_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_ACCEPT:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">accept&nbsp;the&nbsp;client&nbsp;request</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">&nbsp;accept(g_ListenSocket,NULL,NULL);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">in&nbsp;fact&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;peer&nbsp;when&nbsp;calling&nbsp;accept,&nbsp;here&nbsp;we&nbsp;use&nbsp;getpeername&nbsp;instead</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getpeername(socket,(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">name,</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">namelen);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">send&nbsp;a&nbsp;message&nbsp;of&nbsp;logining&nbsp;to&nbsp;other&nbsp;clients</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">A&nbsp;guest&nbsp;joins&nbsp;us.(%s:%d)\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,inet_ntoa(name.sin_addr),ntohs(name.sin_port));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">send&nbsp;a&nbsp;welcome&nbsp;message&nbsp;to&nbsp;current&nbsp;client</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,&nbsp;</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Welcome&nbsp;!(You&nbsp;ID&nbsp;is:&nbsp;%s:%d.)\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,inet_ntoa(name.sin_addr),ntohs(name.sin_port));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">send(socket,buffer,strlen(buffer),0);</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(socket,buffer,strlen(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">refresh&nbsp;srceen&nbsp;text</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">push&nbsp;the&nbsp;client&nbsp;socket&nbsp;down&nbsp;to&nbsp;the&nbsp;client&nbsp;sockets&nbsp;list</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_DataSockets.push_back(socket);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_READ:<br><img id="Codehighlighter1_1739_2144_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1739_2144_Open_Text.style.display='none'; Codehighlighter1_1739_2144_Closed_Image.style.display='inline'; Codehighlighter1_1739_2144_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1739_2144_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1739_2144_Closed_Text.style.display='none'; Codehighlighter1_1739_2144_Open_Image.style.display='inline'; Codehighlighter1_1739_2144_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1739_2144_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1739_2144_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">get&nbsp;the&nbsp;client&nbsp;message,&nbsp;the&nbsp;client&nbsp;socket&nbsp;ID&nbsp;is&nbsp;wParam</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retCode</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">recv((SOCKET)wParam,buffer,BUFFER_SIZE,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer[retCode]</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">NULL;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">send&nbsp;the&nbsp;received&nbsp;message&nbsp;to&nbsp;other&nbsp;clients</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img id="Codehighlighter1_1976_2068_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1976_2068_Open_Text.style.display='none'; Codehighlighter1_1976_2068_Closed_Image.style.display='inline'; Codehighlighter1_1976_2068_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1976_2068_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1976_2068_Closed_Text.style.display='none'; Codehighlighter1_1976_2068_Open_Image.style.display='inline'; Codehighlighter1_1976_2068_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1976_2068_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1976_2068_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(wParam</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">g_DataSockets[i])<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">refresh&nbsp;screen</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_WRITE:<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">case</span><span style="color: rgb(0, 0, 0);">&nbsp;FD_CLOSE:&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">Client&nbsp;gracefully&nbsp;close&nbsp;the&nbsp;socket<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">close&nbsp;the&nbsp;client&nbsp;socket&nbsp;who&nbsp;has&nbsp;left,&nbsp;the&nbsp;client&nbsp;socket&nbsp;ID&nbsp;is&nbsp;wParam</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getpeername((SOCKET)wParam,(sockaddr</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">name,</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">namelen);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket((SOCKET)wParam);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">erase&nbsp;the&nbsp;client&nbsp;socket&nbsp;from&nbsp;client&nbsp;socks&nbsp;list</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ite</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">std::find(g_DataSockets.begin(),&nbsp;g_DataSockets.end(),(SOCKET)wParam);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(ite</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">g_DataSockets.end());<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_DataSockets.erase(ite);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 128, 0);">//</span><span style="color: rgb(0, 128, 0);">refresh&nbsp;screen</span><span style="color: rgb(0, 128, 0);"><br><img src="inblock.gif" align="top"></span><span style="color: rgb(0, 0, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buffer,&nbsp;</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Client&nbsp;%s:%d&nbsp;left.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">,&nbsp;inet_ntoa(name.sin_addr),ntohs(name.sin_port));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;&nbsp;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();&nbsp;i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">break</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedblockend.gif" align="top">}</span></span></div>

<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">1</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">int PASCAL FAR getpeername( SOCKET s, struct sockaddr FAR* name,int FAR* namelen);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">　　</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">s</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：标识一已连接套接口的描述字。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">　　</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">name</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：接收端地址的名字结构。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 25.5pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">namelen</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：一个指向名字结构的指针。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; line-height: 20.1pt;"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">2</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">）</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">u_short PASCAL FAR ntohs( u_short netshort);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 25.5pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">netshort</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">：一个以网络字节顺序表达的</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">16</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">位数。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-indent: 24.75pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">本函数将一个</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">16</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">位数由网络字节顺序转换为主机字节顺序。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 12pt 0cm 0pt 18pt; text-indent: -18pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><span style="">3）<span style="font: 7pt 'Times New Roman';"> </span></span></span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">SOCKET accept(SOCKET s,struct sockaddr FAR * addr,int FAR * addrlen);<o:p></o:p></span></p>
<p class="MsoNormal" style="margin: 12pt 0cm 0pt 18pt; line-height: 20.1pt; text-align: left;" align="left"><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">如果是服务器并不关心对方的地址，则可将</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">accept</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">函数中后两个参数设置为</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US">NULL</span><span style="font-size: 11.5pt; color: black; font-family: 宋体; letter-spacing: 0.4pt;">。</span><span style="font-size: 11.5pt; color: black; font-family: Arial; letter-spacing: 0.4pt;" lang="EN-US"><o:p></o:p></span></p>
9、最后，介绍3个辅助函数：ExitChat、GetErrorReason和RefreshScreen<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当新建服务器或链接服务器的时候，首先需要将上一次会话关闭，ExitChat函数完成此功能。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen函数负责刷新显示内容并滚动显示文本框。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetErrorReason函数负责获得当前操作中的具体错误原因。
<div style="border-right: 1px solid rgb(204, 204, 204); padding: 4px 5px 4px 4px; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); font-size: 13px; width: 98%; background-color: rgb(238, 238, 238);"><img src="none.gif" align="top"><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;ExitChat(HWND&nbsp;hWnd)<br><img id="Codehighlighter1_25_636_Open_Image" onclick="this.style.display='none'; Codehighlighter1_25_636_Open_Text.style.display='none'; Codehighlighter1_25_636_Closed_Image.style.display='inline'; Codehighlighter1_25_636_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_25_636_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_25_636_Closed_Text.style.display='none'; Codehighlighter1_25_636_Open_Image.style.display='inline'; Codehighlighter1_25_636_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_25_636_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_25_636_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;i;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;buffer[BUFFER_SIZE];<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(g_bActive)<br><img id="Codehighlighter1_78_616_Open_Image" onclick="this.style.display='none'; Codehighlighter1_78_616_Open_Text.style.display='none'; Codehighlighter1_78_616_Closed_Image.style.display='inline'; Codehighlighter1_78_616_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_78_616_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_78_616_Closed_Text.style.display='none'; Codehighlighter1_78_616_Open_Image.style.display='inline'; Codehighlighter1_78_616_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_78_616_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_78_616_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">if</span><span style="color: rgb(0, 0, 0);">(g_bClient)<br><img id="Codehighlighter1_98_231_Open_Image" onclick="this.style.display='none'; Codehighlighter1_98_231_Open_Text.style.display='none'; Codehighlighter1_98_231_Closed_Image.style.display='inline'; Codehighlighter1_98_231_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_98_231_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_98_231_Closed_Text.style.display='none'; Codehighlighter1_98_231_Open_Image.style.display='inline'; Codehighlighter1_98_231_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_98_231_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_98_231_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket(g_ClientSocket);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Successfully&nbsp;log&nbsp;out.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">else</span><span style="color: rgb(0, 0, 0);"><br><img id="Codehighlighter1_242_613_Open_Image" onclick="this.style.display='none'; Codehighlighter1_242_613_Open_Text.style.display='none'; Codehighlighter1_242_613_Closed_Image.style.display='inline'; Codehighlighter1_242_613_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_242_613_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_242_613_Closed_Text.style.display='none'; Codehighlighter1_242_613_Open_Image.style.display='inline'; Codehighlighter1_242_613_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_242_613_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_242_613_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">I&nbsp;will&nbsp;leave.&nbsp;Pls&nbsp;clients&nbsp;log&nbsp;out&nbsp;ASAP.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">for</span><span style="color: rgb(0, 0, 0);">(i</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;&nbsp;i</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 0, 0);">g_DataSockets.size();&nbsp;i</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">)<br><img id="Codehighlighter1_355_445_Open_Image" onclick="this.style.display='none'; Codehighlighter1_355_445_Open_Text.style.display='none'; Codehighlighter1_355_445_Closed_Image.style.display='inline'; Codehighlighter1_355_445_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_355_445_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_355_445_Closed_Text.style.display='none'; Codehighlighter1_355_445_Open_Image.style.display='inline'; Codehighlighter1_355_445_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_355_445_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_355_445_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Send(g_DataSockets[i],buffer,strlen(buffer));<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket(g_DataSockets[i]);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_DataSockets.clear();<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closesocket(g_ListenSocket);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">Successfully&nbsp;close&nbsp;server.\r\n</span><span style="color: rgb(0, 0, 0);">"</span><span style="color: rgb(0, 0, 0);">);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">buffer;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RefreshScreen(hWnd);<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_bActive</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">FALSE;<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;GetErrorReason()<br><img id="Codehighlighter1_661_937_Open_Image" onclick="this.style.display='none'; Codehighlighter1_661_937_Open_Text.style.display='none'; Codehighlighter1_661_937_Closed_Image.style.display='inline'; Codehighlighter1_661_937_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_661_937_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_661_937_Closed_Text.style.display='none'; Codehighlighter1_661_937_Open_Image.style.display='inline'; Codehighlighter1_661_937_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_661_937_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_661_937_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;lpMsgBuf;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FORMAT_MESSAGE_FROM_SYSTEM</span><span style="color: rgb(0, 0, 0);">|</span><span style="color: rgb(0, 0, 0);">FORMAT_MESSAGE_IGNORE_INSERTS,<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,WSAGetLastError(),MAKELANGID(LANG_NEUTRAL,&nbsp;SUBLANG_DEFAULT),&nbsp;(LPTSTR)&nbsp;</span><span style="color: rgb(0, 0, 0);">&amp;</span><span style="color: rgb(0, 0, 0);">lpMsgBuf,</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">,NULL);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;g_ChatWords</span><span style="color: rgb(0, 0, 0);">+=</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 255);">char</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(0, 0, 0);">*</span><span style="color: rgb(0, 0, 0);">)lpMsgBuf;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;LocalFree(&nbsp;lpMsgBuf&nbsp;);<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span><span style="color: rgb(0, 0, 255);">void</span><span style="color: rgb(0, 0, 0);">&nbsp;RefreshScreen(HWND&nbsp;hWnd)<br><img id="Codehighlighter1_969_1246_Open_Image" onclick="this.style.display='none'; Codehighlighter1_969_1246_Open_Text.style.display='none'; Codehighlighter1_969_1246_Closed_Image.style.display='inline'; Codehighlighter1_969_1246_Closed_Text.style.display='inline';" src="expandedblockstart.gif" align="top"><img id="Codehighlighter1_969_1246_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_969_1246_Closed_Text.style.display='none'; Codehighlighter1_969_1246_Open_Image.style.display='inline'; Codehighlighter1_969_1246_Open_Text.style.display='inline';" src="contractedblock.gif" align="top"></span><span id="Codehighlighter1_969_1246_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_969_1246_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;HWND&nbsp;subWnd;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;std::</span><span style="color: rgb(0, 0, 255);">string</span><span style="color: rgb(0, 0, 0);">::size_type&nbsp;pos;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">int</span><span style="color: rgb(0, 0, 0);">&nbsp;n;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;subWnd</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">GetDlgItem(hWnd,IDC_SHOWTEXT);<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;SetWindowText(subWnd,&nbsp;g_ChatWords.c_str());<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;n</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;pos</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: rgb(0, 0, 255);">while</span><span style="color: rgb(0, 0, 0);">((pos</span><span style="color: rgb(0, 0, 0);">=</span><span style="color: rgb(0, 0, 0);">g_ChatWords.find(</span><span style="color: rgb(0, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">\n</span><span style="color: rgb(0, 0, 0);">'</span><span style="color: rgb(0, 0, 0);">,pos))</span><span style="color: rgb(0, 0, 0);">!=</span><span style="color: rgb(0, 0, 0);">std::</span><span style="color: rgb(0, 0, 255);">string</span><span style="color: rgb(0, 0, 0);">::npos)<br><img id="Codehighlighter1_1182_1201_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1182_1201_Open_Text.style.display='none'; Codehighlighter1_1182_1201_Closed_Image.style.display='inline'; Codehighlighter1_1182_1201_Closed_Text.style.display='inline';" src="expandedsubblockstart.gif" align="top"><img id="Codehighlighter1_1182_1201_Closed_Image" style="display: none;" onclick="this.style.display='none'; Codehighlighter1_1182_1201_Closed_Text.style.display='none'; Codehighlighter1_1182_1201_Open_Image.style.display='inline'; Codehighlighter1_1182_1201_Open_Text.style.display='inline';" src="contractedsubblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="Codehighlighter1_1182_1201_Closed_Text" style="border-right: 1px solid rgb(128, 128, 128); border-width: 1px; border-style: solid; border-color: rgb(128, 128, 128); display: none; background-color: rgb(255, 255, 255);"><img src="dot.gif"></span><span id="Codehighlighter1_1182_1201_Open_Text"><span style="color: rgb(0, 0, 0);">{<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">;<br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n</span><span style="color: rgb(0, 0, 0);">++</span><span style="color: rgb(0, 0, 0);">;<br><img src="expandedsubblockend.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="inblock.gif" align="top">&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(subWnd,&nbsp;EM_LINESCROLL,&nbsp;</span><span style="color: rgb(0, 0, 0);">0</span><span style="color: rgb(0, 0, 0);">,&nbsp;n);<br><img src="expandedblockend.gif" align="top">}</span></span><span style="color: rgb(0, 0, 0);"><br><img src="none.gif" align="top"></span></div>

	<div class="postDesc">posted on 2009-06-21 00:23 <a href="http://www.cppblog.com/The-Moment/">The_Moment</a> 阅读(803) <a href="#Post">评论(0)</a> &nbsp;<a href="http://www.cppblog.com/The-Moment/admin/EditPosts.aspx?postid=88200">编辑</a>&nbsp;<a href="http://www.cppblog.com/The-Moment/AddToFavorite.aspx?id=88200">收藏</a> <a href="http://www.cppblog.com/The-Moment/services/trackbacks/88200.aspx">引用</a>  所属分类: <a href="http://www.cppblog.com/The-Moment/category/10913.html">VC理论</a> </div>
</div>
<img src="88200.html" height="1" width="1">

<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
rdf:about="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.html"
dc:identifier="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.html"
dc:title="Winsock详解"
trackback:ping="http://www.cppblog.com/The-Moment/services/trackbacks/88200.aspx" />
</rdf:RDF>
-->


<div id="AjaxHolder_UpdatePanel1">
	    
    

<!--Beging Temp Save-->

<div class="userData" id="CommentsPersistDiv"></div>

<!--Ene TempSave-->
<div class="commentform">




<span id="AjaxHolder_PostComment_ltSubmitMsg"><font color="Red"></font></span>
<br>
<a name="Feedback"></a>
	<table border="0" cellpadding="1" cellspacing="1">
		<tbody><tr>			
		<td id="AjaxHolder_PostComment_tdOnCommentForm" colspan="3">
		<a href="http://q.cnblogs.com/" target="_top">博问 - 解决您的IT难题</a><br>
				
		</td>
	
		</tr>
		<tr>
			<td colspan="3">

<br> </td>
		</tr>
		<tr>
			<td width="75"></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td></td>
			<td colspan="2">
			<a href="http://www.cnblogs.com/" target="_top">博客园</a>&nbsp;  <a href="http://q.cnblogs.com/" target="_top">博问</a>&nbsp; <a href="http://news.cnblogs.com/" target="_top">IT新闻</a>&nbsp; <!--<a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a>&nbsp;  --><a href="http://job.cnblogs.com/cate-cpp_programmer/" target="_top">C++程序员招聘</a>
			</td>
		</tr>
		<tr>
			<td width="55">标题</td>
			<td><input name="AjaxHolder$PostComment$tbTitle" value="re: Winsock详解" id="AjaxHolder_PostComment_tbTitle" class="commenttb" style="" type="text"></td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td>姓名</td>
			<td><input value="" name="AjaxHolder$PostComment$tbName" id="AjaxHolder_PostComment_tbName" class="commenttb" style="" type="text"></td>
			<td>&nbsp;</td>
		</tr>
		<tr>
			<td>主页</td>
			<td><input value="" name="AjaxHolder$PostComment$tbUrl" id="AjaxHolder_PostComment_tbUrl" class="commenttb" style="" type="text"></td>
			<td><font face="宋体"></font></td>
		</tr>
		<tr>
			<td colspan="3" align="left">
				<table id="AjaxHolder_PostComment_tbCaptchaImage" class="CommentForm" border="0" cellpadding="0" cellspacing="0">
		<tbody><tr>
			<td colspan="3">
							
							<span id="AjaxHolder_PostComment_lblImage"><b><font color="Red"></font></b></span>
						</td>
		</tr>
		<tr>
			<td width="78">验证码</td>
			<td><input value="" name="AjaxHolder$PostComment$CodeNumberTextBox" id="AjaxHolder_PostComment_CodeNumberTextBox" type="text">*</td>
			<td align="left">
							<img src="jpegimage.aspx" id="AjaxHolder_PostComment_Img1">
						</td>
		</tr>
	</tbody></table>
	
			</td>
		</tr>
		<tr>
			<td colspan="3">内容(提交失败后,可以通过“恢复上次提交”恢复刚刚提交的内容)
				&nbsp;<br>
				<textarea name="AjaxHolder$PostComment$tbComment" rows="10" cols="50" id="AjaxHolder_PostComment_tbComment" class="commentTextBox" onkeydown="ctlent(event,'AjaxHolder_PostComment_tbComment')" style=""></textarea></td>
		</tr>
		<tr>
			<td colspan="3">
		<span id="AjaxHolder_PostComment_Message"><font color="Red"></font></span>
		</td>
		</tr><tr>
			<td colspan="3"><input id="AjaxHolder_PostComment_chkRemember" name="AjaxHolder$PostComment$chkRemember" checked="checked" tabindex="-1" type="checkbox"><label for="AjaxHolder_PostComment_chkRemember">Remember Me?</label></td>
		</tr>
		<tr>
			<td height="23"><input name="AjaxHolder$PostComment$btnSubmit" value="提交" onclick="TempSave('AjaxHolder_PostComment_tbComment');WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;AjaxHolder$PostComment$btnSubmit&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" id="AjaxHolder_PostComment_btnSubmit" type="submit">
				</td>
			<td colspan="2" height="23">&nbsp;
				<a id="AjaxHolder_PostComment_lnkLogin" href="http://www.cppblog.com/login.aspx?ReturnURL=http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx&amp;SourceURL=/The-Moment/archive/2009/06/21/88200.aspx">登录</a>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_linkLoginComment" onclick="if(document.getElementById('AjaxHolder_PostComment_tbComment').value != '') return confirm('未提交的评论内容将会丢失, 你真的要进入高级评论吗?');" href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx?login=1#Post">使用高级评论</a>&nbsp;&nbsp;<a href="http://www.cppblog.com/RequireRegister.aspx">新用户注册</a>&nbsp;&nbsp;<a href="#Top">返回页首</a>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_lbRestore" onclick="Restore('AjaxHolder_PostComment_tbComment'); return false;" href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx#Post">恢复上次提交</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				</td>
		</tr>
		<tr>
			<td colspan="3">[使用Ctrl+Enter键可以直接提交]</td>
		</tr>
		<tr>
		<td colspan="3">
		
		</td>
		</tr>
		<tr>			
		<td colspan="3">
		<div id="itnews_block" style="line-height: 180%;" class="other_info_list">IT新闻：<br>· <a href="http://news.cnblogs.com/n/141182/" target="_top">微软将于6月20日举行开发者峰会 或将放出Windows Phone 8详情</a><br>· <a href="http://news.cnblogs.com/n/141181/" target="_top">微软Windows Phone 8测试版有768×768分辨率？</a><br>· <a href="http://news.cnblogs.com/n/141180/" target="_top">哈佛大学和MIT将联合创建免费开源在线课程项目edX</a><br>· <a href="http://news.cnblogs.com/n/141179/" target="_top">阴暗面：你有所不知的应用内支付</a><br>· <a href="http://news.cnblogs.com/n/141178/" target="_top">三星Bada陨落！Bada平台智能机开发已停止</a><br></div><div id="cnblogs_posts" style="line-height: 1.8;">博客园首页随笔：<br>· <a href="http://www.cnblogs.com/yewei/archive/2012/05/03/2480688.html" target="_top">Poj3468 线段树 -- 成段更新</a><br>· <a href="http://www.cnblogs.com/dangxia/archive/2012/05/03/2480684.html" target="_top">OV7725寄存器配置之PCLK、帧率</a><br>· <a href="http://www.cnblogs.com/sharpwang/archive/2012/05/03/2480114.html" target="_top">CPU瓶颈（二）--过度的查询语句编译及优化</a><br>· <a href="http://www.cnblogs.com/lisperl/archive/2012/05/03/2480573.html" target="_top">Linux Namespaces机制——实现</a><br>· <a href="http://www.cnblogs.com/xiaoyao2011/archive/2012/05/03/Jeditable-ASPNET-MVC.html" target="_top">Jeditable - jQuery就地编辑插件在ASP.NET MVC 中的使用</a><br></div><div id="job_block" style="line-height: 1.8;">知识库：<br>· <a href="http://kb.cnblogs.com/page/141172/" target="_top">我最喜欢的10条编程语录</a><br>· <a href="http://kb.cnblogs.com/page/140612/" target="_top">版本控制入门简介</a><br>· <a href="http://kb.cnblogs.com/page/140870/" target="_top">Javascript 编程风格</a><br>· <a href="http://kb.cnblogs.com/page/140950/" target="_top">通天塔导游 - 细数各种编程语言优缺点</a><br>· <a href="http://kb.cnblogs.com/page/140015/" target="_top">中文编码杂谈</a><br></div>
		</td>
		</tr>
		<tr>
			<td colspan="3" height="5">
<div id="divRelativePosts">
相关文章:
	
			<ul style="margin-top: 0px; line-height: 1.8;">
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl01_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/29/91556.html">C、C++和MFC中文件的读写方法</a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl02_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/07/11/89773.html">VC中_T()的作用 </a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl03_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88215.html">VC文本处理</a>
			</li>
		
			<li style="list-style: none outside none; display: none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl04_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.html"><b style="color: black; background-color: rgb(255, 255, 102);">Winsock详解</b></a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl05_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/18/88043.html">使用ADO的具体方法</a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl06_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/18/88011.html">vc数据类型转换大全 </a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl07_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/17/87892.html">AppFace For VC （VC界面）</a>
			</li>
		
			<li style="list-style: none outside none;">
				<a id="AjaxHolder_PostComment_ctl08_RelativePostsList_ctl08_Hyperlink1" href="http://www.cppblog.com/The-Moment/archive/2009/06/17/87878.html">BOOL和bool的区别</a>
			</li>
		
			</ul>
		
</div>
</td>
		</tr>
		<tr>
			<td colspan="3"></td>
		</tr>
		<tr>
			<td colspan="3" height="1"><div id="blogsite">网站导航:
			<a href="http://www.cnblogs.com/">博客园</a>&nbsp;&nbsp;
			<a href="http://news.cnblogs.com/">IT新闻</a>&nbsp;&nbsp;
			<a href="http://www.blogjava.net/">BlogJava</a>&nbsp;&nbsp;
			<a href="http://kb.cnblogs.com/">知识库</a>&nbsp;&nbsp;
			<a href="http://job.cnblogs.com/">程序员招聘</a>&nbsp;&nbsp;
			<a href="http://www.cppblog.com/The-Moment/archive/2009/06/21/88200.aspx?opt=admin">管理</a>
			</div></td>
		</tr>
		<tr>
			<td colspan="3">
				
<br>

<br>

</td>
		</tr>
	</tbody></table>	
</div>


</div>

				
</div>

<!--done-->
<div class="footer">
	
	Copyright ©2012 The_Moment Powered By<a href="http://www.cppblog.com/">博客园</a> 模板提供：<a href="http://blog.hjenglish.com/">沪江博客</a>
</div>    
    


</form>
	   
	



</div>



</body>
</html>
