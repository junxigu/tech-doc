<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>备忘--WinSock2编程基础（一） – 【人人分享-人人网】</title>

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta name="Description" content="人人网 校内是一个真实的社交网络，联络你和你周围的朋友。 加入人人网校内你可以:联络朋友，了解他们的最新动态；和朋友分享相片、音乐和电影；找到老同学，结识新朋友；用照片和日志记录生活,展示自我。">
<meta name="Keywords" content="Xiaonei,Renren,校内,大学,同学,同事,白领,个人主页,博客,相册,群组,社区,交友,聊天,音乐,视频,校园,人人,人人网">
<meta name="msapplication-task" content="name=新鲜事;action-uri=http://www.renren.com/home;icon-uri=http://a.xnimg.cn/n/res/icons/newsfeed.ico">
<meta name="msapplication-task" content="name=日志;action-uri=http://blog.renren.com;icon-uri=http://a.xnimg.cn/n/res/icons/blog.ico">
<meta name="msapplication-task" content="name=相册;action-uri=http://photo.renren.com;icon-uri=http://a.xnimg.cn/n/res/icons/photo.ico">
<meta name="msapplication-task" content="name=音乐;action-uri=http://music.renren.com;icon-uri=http://a.xnimg.cn/n/res/icons/music.ico">
<meta name="msapplication-task" content="name=分享;action-uri=http://share.renren.com;icon-uri=http://a.xnimg.cn/n/res/icons/share.ico"><link rel="shortcut icon" type="image/x-icon" href="favicon-rr.ico">
<link rel="apple-touch-icon" href="http://a.xnimg.cn/wap/apple_icon_.png">
<!--[if IE]><script type="text/javascript" src="http://s.xnimg.cn/a30950/n/core/expressions.js"></script><![endif]-->









<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body id="pageShare"><ul class="autocomplete_panel" style="border: 1px solid rgb(204, 204, 204); background: none repeat scroll 0% 0% rgb(245, 245, 245); padding: 1px; margin: 0px; list-style: none outside none; position: absolute; display: none;"></ul>		
<input id="userGuideType" value="" type="hidden">
<div id="dropmenuHolder" class="dropmenu-holder dropmenu-holder-new rr">
<div id="moredownWeb" class="dropdown" style="display: block; position: absolute; z-index: 10001; left: -9999px; top: -9999px;">
<div class="menu-dropdown-border">
<div class="weblist">
<ul class="clearfix">
<li><a href="http://share.renren.com/">分享</a></li>
<li><a href="http://app.renren.com/">应用程序</a></li>
<li><a href="http://page.renren.com/">公共主页</a></li>
<li><a href="http://life.renren.com/">人人生活</a></li>
<li><a href="http://xiaozu.renren.com/">人人小组</a></li>
<li><a href="http://name.renren.com/">同名同姓</a></li>
<li><a href="http://school.renren.com/allpages.html">人人中学</a></li>
<li><a href="http://school.renren.com/daxue/">大学百科</a></li>
<li><a href="http://life.renren.com/hot">人人热点</a></li>
</ul>
</div>
</div>
<div></div></div></div>
<div id="topbar"></div><div id="header">
<div id="navBar" class="site-nav rr">
<div class="navigation-wrapper">
<div class="navigation navigation-new clearfix"><div id="logo2"><h1><a href="http://www.renren.com/" title="人人网 renren.com - 人人网校内是一个真实的社交网络，联系朋友，一起玩游戏"><img alt="人人网 renren.com - 人人网校内是一个真实的社交网络，联系朋友，一起玩游戏" title="人人网 renren.com - 人人网校内是一个真实的社交网络，联系朋友，一起玩游戏" src="logo-rr-159.png" height="35" width="159"></a></h1></div>						<div class="nav-body clearfix"><div class="nav-other"><div class="menu">
<div class="menu-title">
<strong>
<a id="reg_link" title="注册" stats="homenav_reg" href="http://wwv.renren.com/xn.do?ss=10113&amp;rt=27">注册</a>
</strong>
</div>
</div>
<div class="menu">
<div class="menu-title">
<strong>
<a title="登录" stats="homenav_login" href="http://www.renren.com/">登录</a>
</strong>
</div>
</div><div class="menu">
<div class="menu-title">
<strong>
<a title="帮助" stats="homenav_help" href="http://support.renren.com/helpcenter">帮助</a>
</strong>
</div>
</div>
<div class="menu">
<div class="menu-title">
<strong>
<a title="给我们提建议" stats="homenav_suggest" href="http://support.renren.com/link/suggest">给我们提建议</a>
</strong>
</div>
</div>
<div class="menu last">
<div class="menu-title" stats="homenav_more" id="moreWeb"><a href="#" onclick="this.blur();">更多</a></div>
</div></div>
</div>
</div>
</div>
</div>
</div>

<div class="full-page-holder">
<div class="full-page clearfix">
<div class="reg-tip"><h4>
加入人人网，找回老朋友，结交新朋友。
</h4>
<span class="reg-now"><a href="javascript:showReg(0);">加入人人网</a>
</span>
<span class="r-bl"></span>
<span class="r-br"></span>
</div><div class="pagemain">
<div class="page-titletabs clearfix">
<div class="title-name title-share">
<a href="http://share.renren.com/" target="_top">分享</a>
</div>
<a href="http://share.renren.com/" title="返回分享首页" class="return-index">返回分享首页»</a></div>
<div class="share-home terminal">
<div class="share-newacts">
<a href="javascript:showReg(0);">分享</a>
</div>
<h1 class="title-article">
<strong>备忘--WinSock2编程基础（一）</strong>
</h1>
<h3 class="title-article">
<span class="blog-legend">来源：</span>
<span class="blog-detail"> <span class="name"> <a href="javascript:showReg(0);">薛海伟的日志</a> </span> </span>
</h3>
<div class="text-article">
<div class="content-body" id="shareBody">

<p>注：以下内容均来自网上：</p><p>&nbsp;</p><p><font size="2">1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前言</font> </p><p><font size="2">在一些常用的编程技术中，Socket网络编程可以说是最简单的一种。而且Socket编程需要的基础知识很少，适合初学者学习网络编程。目前支持网络传输的技术、语言和工具繁多，但是大部分都是基于Socket开发的，虽说这些“高级”的网络技术屏蔽了大部分底层实现，号称能极大程度的简化开发，而事实上如果你没有一点Socket基础，要理解和应用这些技术还是很困难的，而且会让你成为“半瓢水”。</font></p><p><font size="2">深有感触的是当年我学习CORBA的时候，由于当时各方面的基础薄弱，整整啃了半年书，最终还是一头雾水。如果现在让我带一个人学CORBA，我一定会安排好顺序：首先弄清C++语法；然后是VC编译环境或者nmake的用法；接下来学习一些网络基础知识；然后是Socket编程；这些大概要花费3、4个月。有了这些基础学习CORBA一周即可弄懂，两个月就可以基于CORBA进行开发了。</font></p><p><font size="2">好了，说了半天其实中心思想就一个，Socket很简单，很好学！如果你会C++或者ｊａｖａ，又懂一点点网络基础如TCP和UDP的机制，那么你看完本文就可以熟练进行Socket开发了。</font></p><p><font size="2">2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Socket简介（全文摘抄）</font> </p><p><font size="2">（本节内容全部抄自网络，不保证正确性，有兴趣的可以看看！）</font></p><p><font size="2">80年代初，美国政府的高级研究工程机构（ARPA）给加利福尼亚大学Berkeley分校提供了资金，让他们在UNIX操作系统下实现TCP/IP协议。在这个项目中，研究人员为TCP/IP网络通信开发了一个API（应用程序接口）。这个API称为Socket接口（套接字）。今天，SOCKET接口是TCP/IP网络最为通用的API，也是在INTERNET上进行应用开发最为通用的API。</font></p><p><font size="2">90年代初，由Microsoft联合了其他几家公司共同制定了一套WINDOWS下的网络编程接口，即WindowsSockets规范。它是BerkeleySockets的重要扩充，主要是增加了一些异步函数，并增加了符合Windows消息驱动特性的网络事件异步选择机制。WINDOWSSOCKETS规范是一套开放的、支持多种协议的Windows下的网络编程接口。从1991年的1.0版到1995年的2.0.8版，经过不断完善并在Intel、Microsoft、Sun、SGI、Informix、Novell等公司的全力支持下，已成为Windows网络编程的事实上的标准。目前，在实际应用中的WINDOWSSOKCETS规范主要有1.1版和2.0版。两者的最重要区别是1.1版只支持TCP/IP协议，而2.0版可以支持多协议。2.0版有良好的向后兼容性，任何使用1.1版的源代码，二进制文件，应用程序都可以不加修改地在2.0规范下使用。</font></p><p><font size="2">SOCKET实际在计算机中提供了一个通信端口，可以通过这个端口与任何一个具有SOCKET接口的计算机通信。应用程序在网络上传输，接收的信息都通过这个SOCKET接口来实现。在应用开发中就像使用文件句柄一样，可以对SOCKET句柄进行读，写操作。</font></p><p><font size="2">3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 再说两句</font> </p><p><font size="2">网上很多文章对于Socket的来龙去脉有如教科书一般的精准。但是涉及具体编程技术就往往被VC等集成开发环境所毒害了，把Windows SDK、MFC、Socket、多线程、DLL以及编译链接等等技术搅合在一起煮成一锅夹生饭。</font></p><p><font size="2">既然要学习Socket，就应该用最简单直白的方式把Socket的几个使用要点讲出来。我认为程序员最关心的有以下几点，按照优先级排列如下：</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Socket的机制是什么？</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用C/C++写Socket需要什么头文件、库文件、DLL，它们可以由谁提供，安装后一般处于系统的哪个文件夹内？</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 编写Socket程序需要的编程基础是什么？</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Socket库内最重要的几个函数和数据类型是什么？</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 两个最简单的例子程序；</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一个贴近应用的稍微复杂的Socket应用程序。</font></p><p><font size="2">我将一一讲述这些要点，并给出从简到繁，从朴素到花哨的所有源代码以及编译链接的命令。</font></p><p><font size="2">4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Socket的机制是什么？</font> </p><p><font size="2">我们可以简单的把Socket理解为一个可以连通网络上不同计算机程序之间的管道，把一堆数据从管道的A端扔进去，则会从管道的B端（也许同时还可以从C、D、E、F……端冒出来）。管道的端口由两个因素来唯一确认，即机器的IP地址和程序所使用的端口号。IP地址的含义所有人都知道，所谓端口号就是程序员指定的一个数字，许多著名的木马程序成天在网络上扫描不同的端口号就是为了获取一个可以连通的端口从而进行破坏。比较著名的端口号有http的80端口和ftp的21端口（我记错了么？）。当然，建议大家自己写程序不要使用太小的端口号，它们一般被系统占用了，也不要使用一些著名的端口，一般来说使用1000~5000之内的端口比较好。</font></p><p><font size="2">Socket可以支持数据的发送和接收，它会定义一种称为套接字的变量，发送数据时首先创建套接字，然后使用该套接字的sendto等方法对准某个IP/端口进行数据发送；接收端也首先创建套接字，然后将该套接字绑定到一个IP/端口上，所有发向此端口的数据会被该套接字的recv等函数读出。如同读出文件中的数据一样。</font></p><p><font size="2">5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 所需的头文件、库文件和DLL</font> </p><p><font size="2">对于目前使用最广泛的Windows Socket2.0版本，所需的一些文件如下（以安装了VC6为例说明其物理位置）：</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 头文件winsock2.h，通常处于C:"Program Files"Microsoft Visual Studio"VC98"INCLUDE；查看该头文件可知其中又包含了windows.h和pshpack4.h头文件，因此在windows中的一些常用API都可以使用；</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 库文件Ws2_32.lib，通常处于C:"Program Files"Microsoft Visual Studio"VC98"Lib；</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DLL文件Ws2_32.dll，通常处于C:"WINDOWS"system32，这个是可以猜到的。</font></p><p><font size="2">6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 编写Socket程序需要的编程基础</font> </p><p><font size="2">在开始编写Socket程序之前，需要以下编程基础：</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C++语法；</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一点点windows SDK的基础，了解一些SDK的数据类型与API的调用方式；</font></p><p style="margin-left: 42pt; text-indent: -21pt;"><font size="2">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一点点编译、链接和执行的技术；知道cl和link的最常用用法即可。</font></p><p><font size="2">7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UDP</font> </p><p><font size="2">用最通俗的话讲，所谓UDP，就是发送出去就不管的一种网络协议。因此UDP编程的发送端只管发送就可以了，不用检查网络连接状态。下面用例子来说明怎样编写UDP，并会详细解释每个API和数据类型。</font></p><p><font size="2">7.1&nbsp;UDP广播发送程序</font> </p><p><font size="2">下面是一个用UDP发送广播报文的例子。</font></p><p><font size="2">#include &lt;winsock2.h&gt;</font></p><p><font size="2">#include &lt;iostream.h&gt;</font></p><p><font size="2">void main()</font></p><p><font size="2">{</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; SOCKET sock;&nbsp;&nbsp; //socket套接字</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; char szMsg[] = "this is a UDP test package";//被发送的字段</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; //1.启动SOCKET库，版本为2.0</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; WORD wVersionRequested;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; WSADATA wsaData;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; int err;&nbsp;&nbsp; </font></p><p><font size="2">&nbsp;&nbsp;&nbsp; wVersionRequested = MAKEWORD( 2, 0 );&nbsp;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; err = WSAStartup( wVersionRequested, &amp;wsaData );</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; if ( 0 != err )&nbsp;//检查Socket初始化是否成功</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Socket2.0初始化失败，Exit!";</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; //检查Socket库的版本是否为2.0</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; if (LOBYTE( wsaData.wVersion ) != 2 || HIBYTE( wsaData.wVersion ) != 0 ) </font></p><p><font size="2">&nbsp;&nbsp;&nbsp; {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WSACleanup( );</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return; </font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; //2.创建socket，</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; sock = socket(</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AF_INET,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //internetwork: UDP, TCP, etc</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SOCK_DGRAM,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//SOCK_DGRAM说明是UDP类型</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //protocol</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; if (INVALID_SOCKET == sock ) {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout&lt;&lt;"Socket 创建失败，Exit!";</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; //3.设置该套接字为广播类型，</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; bool opt = true;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; setsockopt(sock, SOL_SOCKET, SO_BROADCAST, reinterpret_cast&lt;char FAR *&gt;(&amp;opt), sizeof(opt));</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; //4.设置发往的地址</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; sockaddr_in addrto;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //发往的地址&nbsp;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; memset(&amp;addrto,0,sizeof(addrto));</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_family = AF_INET;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //地址类型为internetwork</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_addr.s_addr = INADDR_BROADCAST; //设置ip为广播地址</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_port = htons(7861);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //端口号为7861</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; int nlen=sizeof(addrto);</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; unsigned int uIndex = 1;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; while(true)</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep(1000);&nbsp;//程序休眠一秒</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //向广播地址发送消息</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if( sendto(sock, szMsg,&nbsp;strlen(szMsg), 0, (sockaddr*)&amp;addrto,nlen)</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == SOCKET_ERROR )</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout&lt;&lt;WSAGetLastError()&lt;&lt;endl;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout&lt;&lt;uIndex++&lt;&lt;":an UDP package is sended."&lt;&lt;endl;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; if (!closesocket(sock))&nbsp;//关闭套接字</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WSAGetLastError();</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; if (!WSACleanup())&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //关闭Socket库</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WSAGetLastError();</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; </font></p><p><font size="2">}</font></p><p><font size="2">编译命令：</font></p><p style="background: none repeat scroll 0% 0% silver;"><font size="2">CL /c UDP_Send_Broadcast.cpp</font></p><p><font size="2">链接命令（注意如果找不到该库，则要在后面的/LIBPATH参数后加上库的路径）：</font></p><p style="background: none repeat scroll 0% 0% silver;"><font size="2">link UDP_Send_Broadcast.obj&nbsp;ws2_32.lib</font></p><p><font size="2">执行命令：</font></p><p style="background: none repeat scroll 0% 0% silver;"><font size="2">D:"Code"成品代码"Socket"socket_src&gt;UDP_Send_Broadcast.exe</font></p><p><font size="2">1:an UDP package is sended.</font></p><p><font size="2">2:an UDP package is sended.</font></p><p><font size="2">3:an UDP package is sended.</font></p><p><font size="2">4:an UDP package is sended.</font></p><p><font size="2">^C</font></p><p><font size="2">下面一一解释代码中出现的数据类型与API函数。有耐心的可以仔细看看，没耐心的依葫芦画瓢也可以写程序了。</font></p><p><font size="2">7.2&nbsp;SOCKET类型</font> </p><p><font size="2">SOCKET是socket套接字类型，在WINSOCK2.H中有如下定义：</font></p><p><font size="2">typedef unsigned int&nbsp;&nbsp;&nbsp; u_int;</font></p><p><font size="2">typedef u_int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SOCKET;</font></p><p><font size="2">可知套接字实际上就是一个无符号整型，它将被Socket环境管理和使用。套接字将被创建、设置、用来发送和接收数据，最后会被关闭。</font></p><p><font size="2">7.3&nbsp;WORD类型、MAKEWORD、LOBYTE和HIBYTE宏</font> </p><p><font size="2">WORD类型是一个16位的无符号整型，在WTYPES.H中被定义为：</font></p><p><font size="2">typedef unsigned short WORD;</font></p><p><font size="2">其目的是提供两个字节的存储，在Socket中这两个字节可以表示主版本号和副版本号。使用MAKEWORD宏可以给一个WORD类型赋值。例如要表示主版本号2，副版本号0，可以使用以下代码：</font></p><p><font size="2">WORD wVersionRequested;</font></p><p><font size="2">wVersionRequested = MAKEWORD( 2, 0 );&nbsp;</font></p><p><font size="2">注意低位内存存储主版本号2，高位内存存储副版本号0，其值为0x0002。使用宏LOBYTE可以读取WORD的低位字节，HIBYTE可以读取高位字节。</font></p><p><font size="2">7.4&nbsp;WSADATA类型和LPWSADATA类型</font> </p><p><font size="2">WSADATA类型是一个结构，描述了Socket库的一些相关信息，其结构定义如下：</font></p><p><font size="2">typedef struct WSAData {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wVersion;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WORD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wHighVersion;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; szDe<a>script</a>ion[WSADE<a>script</a>ION_LEN+1];</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; szSystemStatus[WSASYS_STATUS_LEN+1];</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iMaxSockets;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; unsigned short&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iMaxUdpDg;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char FAR *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lpVendorInfo;</font></p><p><font size="2">} WSADATA;</font></p><p><font size="2">typedef WSADATA FAR *LPWSADATA;</font></p><p><font size="2">值得注意的就是wVersion字段，存储了Socket的版本类型。LPWSADATA是WSADATA的指针类型。它们不用程序员手动填写，而是通过Socket的初始化函数WSAStartup读取出来。</font></p><p><font size="2">7.5&nbsp;WSAStartup函数</font> </p><p><font size="2">WSAStartup函数被用来初始化Socket环境，它的定义如下：</font></p><p><font size="2">int PASCAL FAR WSAStartup(WORD wVersionRequired, LPWSADATA lpWSAData);</font></p><p><font size="2">其返回值为整型，调用方式为PASCAL（即标准类型，PASCAL等于__stdcall），参数有两个，第一个参数为WORD类型，指明了Socket的版本号，第二个参数为WSADATA类型的指针。</font></p><p><font size="2">若返回值为0，则初始化成功，若不为0则失败。</font></p><p><font size="2">7.6&nbsp;WSACleanup函数</font> </p><p><font size="2">这是Socket环境的退出函数。返回值为0表示成功，SOCKET_ERROR表示失败。</font></p><p><font size="2">7.7&nbsp;socket函数</font> </p><p><font size="2">socket的创建函数，其定义为：</font></p><p><font size="2">SOCKET PASCAL FAR socket (int af, int type, int protocol);</font></p><p><font size="2">第一个参数为int af，代表网络地址族，目前只有一种取值是有效的，即AF_INET，代表internet地址族；</font></p><p><font size="2">第二个参数为int type，代表网络协议类型，SOCK_DGRAM代表UDP协议，SOCK_STREAM代表TCP协议；</font></p><p><font size="2">第三个参数为int protocol，指定网络地址族的特殊协议，目前无用，赋值0即可。</font></p><p><font size="2">返回值为SOCKET，若返回INVALID_SOCKET则失败。</font></p><p><font size="2">7.8&nbsp;setsockopt函数</font> </p><p><font size="2">这个函数用来设置Socket的属性，若不能正确设置socket属性，则数据的发送和接收会失败。定义如下：</font></p><p><font size="2">int PASCAL FAR setsockopt (SOCKET s, int level, int optname,</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const char FAR * optval, int optlen);</font></p><p><font size="2">其返回值为int类型，0代表成功，SOCKET_ERROR代表有错误发生。</font></p><p><font size="2">第一个参数SOCKET s，代表要设置的套接字；</font></p><p><font size="2">第二个参数int level，代表要设置的属性所处的层次，层次包含以下取值：SOL_SOCKET代表套接字层次；IPPROTO_TCP代表TCP协议层次，IPPROTO_IP代表IP协议层次（后面两个我都没有用过）；</font></p><p><font size="2">第三个参数int optname，代表设置参数的名称，SO_BROADCAST代表允许发送广播数据的属性，其它属性可参考MSDN；</font></p><p><font size="2">第四个参数const char FAR * optval，代表指向存储参数数值的指针，注意这里可能要使用reinterpret_cast类型转换；</font></p><p><font size="2">第五个参数int optlen，代表存储参数数值变量的长度。</font></p><p><font size="2">7.9&nbsp;sockaddr_in、in_addr类型，inet_addr、inet_ntoa函数</font> </p><p><font size="2">sockaddr_in定义了socket发送和接收数据包的地址，定义：</font></p><p><font size="2">struct sockaddr_in {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; short&nbsp;&nbsp; sin_family;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u_short sin_port;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct&nbsp;in_addr sin_addr;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char&nbsp;&nbsp;&nbsp; sin_zero[8];</font></p><p><font size="2">};</font></p><p><font size="2">其中in_addr的定义如下：</font></p><p><font size="2">struct in_addr {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; union {</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct { u_char s_b1,s_b2,s_b3,s_b4; } S_un_b;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct { u_short s_w1,s_w2; } S_un_w;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; u_long S_addr;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } S_un;</font></p><p><font size="2">首先阐述in_addr的含义，很显然它是一个存储ip地址的联合体（忘记union含义的请看c++书），有三种表达方式：</font></p><p><font size="2">第一种用四个字节来表示IP地址的四个数字；</font></p><p><font size="2">第二种用两个双字节来表示IP地址；</font></p><p><font size="2">第三种用一个长整型来表示IP地址。</font></p><p><font size="2">给in_addr赋值的一种最简单方法是使用inet_addr函数，它可以把一个代表IP地址的字符串赋值转换为in_addr类型，如</font></p><p><font size="2">addrto.sin_addr.s_addr=inet_addr("192.168.0.2");</font></p><p><font size="2">本例子中由于是广播地址，所以没有使用这个函数。其反函数是inet_ntoa，可以把一个in_addr类型转换为一个字符串。</font></p><p><font size="2">sockaddr_in的含义比in_addr的含义要广泛，其各个字段的含义和取值如下：</font></p><p><font size="2">第一个字段short&nbsp;&nbsp; sin_family，代表网络地址族，如前所述，只能取值AF_INET；</font></p><p><font size="2">第二个字段u_short sin_port，代表IP地址端口，由程序员指定；</font></p><p><font size="2">第三个字段struct&nbsp;in_addr sin_addr，代表IP地址；</font></p><p><font size="2">第四个字段char&nbsp;&nbsp;&nbsp; sin_zero[8]，很搞笑，是为了保证sockaddr_in与SOCKADDR类型的长度相等而填充进来的字段。</font></p><p><font size="2">以下代表指明了广播地址，端口号为7861的一个地址：</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; sockaddr_in addrto;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //发往的地址&nbsp;</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; memset(&amp;addrto,0,sizeof(addrto));</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_family = AF_INET;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //地址类型为internetwork</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_addr.s_addr = INADDR_BROADCAST; //设置ip为广播地址</font></p><p><font size="2">&nbsp;&nbsp;&nbsp; addrto.sin_port = htons(7861);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //端口号为7861</font></p>
</div>
</div>
<p class="stat-area">
<span class="a-nav clearfix">  <span>源地址：<a href="javascript:showReg(0);">http://blog.xiaonei.com/GetEntry.do?id=274613532&amp;owner=233315607
</a> </span> </span>
</p><div class="share-operations">
<div class="new-share-info">
<span class="">来源：<a href="javascript:showReg(0);">薛海伟的日志</a>
</span>
<span class="pipe">|</span>
<span>分享 <strong>0</strong> </span>
<span class="pipe">|</span>
<span>浏览 <strong>40</strong> </span>
</div>
<a class="comment-act" href="javascript:showReg(0);" onclick="javascript:showReg(0);"><span>评论</span> </a>
<span class="pipe">|</span>
<a href="javascript:showReg(0);">分享</a>
<span class="pipe">|</span>
<a href="javascript:showReg(0);"><span>赞</span> </a>
<span class="pipe">|</span>
<a href="javascript:showReg(0);">举报</a></div>
<p></p>
<div class="combox_share">
<ul class="filter clearfix" style="display: none;">
<li>
<a id="friendCmts" href="javascript:;"> <span>  TA的分享评论</span> </a>
</li>
<li>
<a class=" select" id="allCmts" href="javascript:;"><span>全站评论</span> </a>
</li>
</ul>
<div id="cmtsListCon">
<div class="replies" id="friendCmtsList" style="display: none;"><div class="replies" id="ilike">
<dl class="replies" style="display: none;"></dl>
</div><div id="friendCmts_commContainer_575468510"><dl class="replies" id="friendCmts_comment_list" style="display: none;">	
</dl>
</div>
</div>
<div class="replies" id="allCmtsList"><div id="allCmts_commContainer_575468510">
<dl class="replies"></dl>
<dl class="replies" id="allCmts_comment_list" style="display: none;">	
</dl>
</div>
</div>
</div>
<input value="" id="guestName" type="hidden"></div>
</div>
<div class="share-sidebar terminal-side">
<div class="more-shares">
<div id="hotsharelist" class="hot-blog-sidebar shares-list">
<ul class="blog-list clearfix">
<li>
<a title="你们想知道《非你莫属》的法国留学男为什么晕倒么？【坐等天津卫..." href="http://blog.renren.com/share/244361500/13115328522" target="_top">你们想知道《非你莫属》的法国留学男为什么晕倒么？【坐等天津卫...</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="matlab版 “最炫民族风” --- 跟风之作（附音频效果..." href="http://blog.renren.com/share/284882800/13118956911" target="_top">matlab版 “最炫民族风” --- 跟风之作（附音频效果...</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="关于5月20号非你莫属法国留学生求职我想给大家澄清几点，不讨..." href="http://blog.renren.com/share/232954055/13116944578" target="_top">关于5月20号非你莫属法国留学生求职我想给大家澄清几点，不讨...</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="警方提醒市民：刷卡别被“双层复写纸”骗了" href="http://blog.renren.com/share/114436263/13112888412" target="_top">警方提醒市民：刷卡别被“双层复写纸”骗了</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="记者卧底曝金汉斯自助餐内幕：剩饭回收加工再卖   新闻原址h..." href="http://blog.renren.com/share/235324200/13036291542" target="_top">记者卧底曝金汉斯自助餐内幕：剩饭回收加工再卖   新闻原址h...</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="2012.5 南京—厦门，3000元/2人，4天3夜" href="http://blog.renren.com/share/225708371/13027450726" target="_top">2012.5 南京—厦门，3000元/2人，4天3夜</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="自从节操公共主页发了一条关于胃液和精液的状态后。。。" href="http://blog.renren.com/share/281722400/13114489001" target="_top">自从节操公共主页发了一条关于胃液和精液的状态后。。。</a>
<p class="blog-brief">
</p>
</li>
<li>
<a title="任何东西 只要够深 都是一把刀" href="http://blog.renren.com/share/400556000/13114879766" target="_top">任何东西 只要够深 都是一把刀</a>
<p class="blog-brief">
</p>
</li></ul>
<div class="show-more">
<a href="javascript:showReg(0);">显示更多 »</a>
</div>
</div>
</div></div>
</div>
</div>
</div>
<div id="footer">	
<div class="site-footer">
<div class="main">
<ul class="link">
<li><a href="http://www.renren.com/siteinfo/about">关于</a></li>
<li><a href="http://dev.renren.com/">开放平台</a></li>
<li><a href="http://wan.renren.com/">人人游戏</a></li>
<li><a href="http://page.renren.com/register/regGuide/">公共主页</a></li>
<li><a href="http://mobile.renren.com/mobilelink.do?psf=40002">手机人人</a></li>
<li><a href="http://www.nuomi.com/">糯米网团购</a></li>
<li><a href="http://ads.renren.com/">营销服务</a></li>
<li><a href="http://job.renren-inc.com/">招聘</a></li>
<li><a href="http://support.renren.com/helpcenter">客服帮助</a></li>
<li><a href="http://www.renren.com/siteinfo/privacy">隐私</a></li>
</ul>
<span class="copyright">
人人网<span title="revision68482; SJSWT42-13.opi.com">©</span>2012</span>
</div>
<div class="haoes">
北京千橡网景科技发展有限公司：文网文[2009]169号<span class="dot">·</span><a href="http://www.miibeian.gov.cn/" target="_top">京ICP证090254号</a><span class="dot">·</span><span>京公网安备110000000009号</span><span class="dot">·</span><span>甲测资字11002066</span><span class="dot">·</span>文化部监督电子邮箱：wlwh@vip.sina.com
</div>
</div>
</div><!--webpager部分--><!--webpager部分结束-->
<div id="toolBackTo" class="back-to" style="right: 10px;">
<a class="backtotop" href="#top" onclick="window.scrollTo(0,0);return false;">返回顶部
<img src="back-tip.png" class="back-tip">
</a>
</div>
<img style="width: 0pt; height: 0pt;" src="ping">







<!-- start：seo相关代码 --><div style="display: none;" id="mask_layer" class="mask_layer"></div>
<div id="reg_layer" style="display: none;" class="generic_dialog explanation pop_dialog">
<div class="generic_dialog_popup">
<table id="pop_dialog_table" class="pop_dialog_table">
<tbody>
<tr>
<td class="pop_topleft"></td>
<td class="pop_border"></td>
<td class="pop_topright"></td>
</tr>
<tr>
<td class="pop_border"></td>
<td id="pop_content" class="pop_content">
<h2><a href="javascript:;" onclick="closepop()">关闭</a><span id="reg_title">简单登记你的信息，开通人人网帐号</span></h2>
<div class="login" id="reg_tright"> 已经有人人网帐号？&nbsp;&nbsp;&nbsp;<a href="javascript:;" hidefocus="true" onclick="showLogin();">请登录</a></div>
<div class="regAdWrapper">
<div class="regbox">
<!--poploginForm -->
<div id="loginerr"></div>
<form method="post" id="poploginForm" class="share_login" action="http://www.renren.com/PLogin.do" onsubmit="return checkShareLogin();">
<p>
<label for="email">帐号: </label><input style="color: rgb(136, 136, 136);" name="email" class="input-text" id="email" value="用户邮箱/手机号/用户名" type="text">
</p>
<p>
<label for="password">密码:</label>
<input id="password" name="password" error="请输入密码" class="input-text" type="password">
</p>
<p class="autologin">
<label title="为了确保您的信息安全，请不要在网吧或者公共机房勾选此项！" for="popautoLogin">
<input name="autoLogin" id="popautoLogin" value="true" type="checkbox">下次直接登录</label>
<a href="http://safe.renren.com/findPass.do" stats="home_findpassword">忘记密码？</a>
</p>
<p>
<input name="origURL" value="http://www.renren.com/Home.do" type="hidden">
<input name="domain" value="renren.com" type="hidden">
<input id="poplogin" class="input-submit" value="登录" type="submit">
</p>
</form>
<!--loginForm end -->
<div id="reg_wrap" style="display: none;">
<!-- regForm -->
<form class="main_regform" method="post" id="regform" name="regform" action="http://reg.renren.com/s-c-reg.do">
<input name="fromUrl" id="fromUrl" value="http://xiaozu.renren.com" type="hidden">
<input name="iu" id="iu" type="hidden">
<input name="ic" id="ic" type="hidden">
<input name="uuid" id="uuid" type="hidden">
<input name="ss" id="ss" value="10791" type="hidden">
<input name="action_id" id="action_id" value="206260" type="hidden">
<input name="accType" id="accType" value="1" type="hidden">
<input name="g" id="g" type="hidden">
<input name="b" id="b" type="hidden">
<div class="form_row" id="d_email">
<label id="regmail_label" for="regemail">电子邮箱:</label>
<div class="input_wrap">
<input value="" autocomplete="off" name="regEmail" id="regEmail" class="inputtext" type="text">
<span id="dmmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="regEmail_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="regEmail_error_span_i">请输入正确的邮箱，完成注册</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_pwd">
<label for="pwd">设置密码:</label>
<div class="input_wrap">
<input autocomplete="off" maxlength="20" name="pwd" id="pwd" class="inputtext" type="password">
<span id="mmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="pwd_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="pwd_error_span_i">密码必须由6-20个字符组成</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_name">
<label for="name">真实姓名:</label>
<div class="input_wrap">
<input value="" autocomplete="off" name="name" id="name" class="inputtext" type="text">
<span id="xmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="name_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="name_error_span_i">请输入<span style="color: red; font-weight: bold;">真实中文姓名</span>，方便朋友查找</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_gender">
<label>性别:</label>
<div class="input_wrap">
<label class="labelRadio">
<input name="gender" id="gender" value="男生" type="radio">
男</label>
<label class="labelRadio">
<input name="gender" id="gender" value="女生" type="radio">
女</label>
<div class="box-error" id="gender_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="gender_error_span_i"></p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_birthday">
<label>生日:</label>
<div class="input_wrap">
<label for="birth_year">
<select name="birth_year">
<option value="">请选择</option>
<option value="1940">1940</option>
<option value="1941">1941</option>
<option value="1942">1942</option>
<option value="1943">1943</option>
<option value="1944">1944</option>
<option value="1945">1945</option>
<option value="1946">1946</option>
<option value="1947">1947</option>
<option value="1948">1948</option>
<option value="1949">1949</option>
<option value="1950">1950</option>
<option value="1951">1951</option>
<option value="1952">1952</option>
<option value="1953">1953</option>
<option value="1954">1954</option>
<option value="1955">1955</option>
<option value="1956">1956</option>
<option value="1957">1957</option>
<option value="1958">1958</option>
<option value="1959">1959</option>
<option value="1960">1960</option>
<option value="1961">1961</option>
<option value="1962">1962</option>
<option value="1963">1963</option>
<option value="1964">1964</option>
<option value="1965">1965</option>
<option value="1966">1966</option>
<option value="1967">1967</option>
<option value="1968">1968</option>
<option value="1969">1969</option>
<option value="1970">1970</option>
<option value="1971">1971</option>
<option value="1972">1972</option>
<option value="1973">1973</option>
<option value="1974">1974</option>
<option value="1975">1975</option>
<option value="1976">1976</option>
<option value="1977">1977</option>
<option value="1978">1978</option>
<option value="1979">1979</option>
<option value="1980">1980</option>
<option value="1981">1981</option>
<option value="1982">1982</option>
<option value="1983">1983</option>
<option value="1984">1984</option>
<option value="1985">1985</option>
<option value="1986">1986</option>
<option value="1987">1987</option>
<option value="1988">1988</option>
<option value="1989">1989</option>
<option value="1990">1990</option>
<option value="1991">1991</option>
<option value="1992">1992</option>
<option value="1993">1993</option>
<option value="1994">1994</option>
<option value="1995">1995</option>
<option value="1996">1996</option>
<option value="1997">1997</option>
<option value="1998">1998</option>
<option value="1999">1999</option>
<option value="2000">2000</option>
<option value="2001">2001</option>
<option value="2002">2002</option>
<option value="2003">2003</option>
<option value="2004">2004</option>
<option value="2005">2005</option>
<option value="2006">2006</option>
<option value="2007">2007</option>
<option value="2008">2008</option>
<option value="2009">2009</option>
<option value="2010">2010</option>
<option value="2011">2011</option>															 
</select>年 </label>
<label for="birth_month">
<select name="birth_month">
<option value="">--</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12">12</option></select>月 </label>
<label for="birth_day">
<select name="birth_day">































<option value="">--</option><option value="30">30</option><option value="29">29</option><option value="28">28</option><option value="27">27</option><option value="26">26</option><option value="25">25</option><option value="24">24</option><option value="23">23</option><option value="22">22</option><option value="21">21</option><option value="20">20</option><option value="19">19</option><option value="18">18</option><option value="17">17</option><option value="16">16</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="11">11</option><option value="10">10</option><option value="9">9</option><option value="8">8</option><option value="7">7</option><option value="6">6</option><option value="5">5</option><option value="4">4</option><option value="3">3</option><option value="2">2</option><option value="1">1</option></select>日 
</label>
<div class="box-error" id="birthday_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="birthday_error_span_i"></p>
</div>
</div>
</div>
<p class="b_tip">
<a href="http://blog.renren.com/share/221751103/%E5%87%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E4%BA%BA%E4%BA%BA%E7%BD%91%E7%94%A8%E6%88%B7%E7%9A%84%E7%9C%9F%E5%AE%9E%E6%80%A7%EF%BC%8C%E5%87%A1%E6%B3%A8%E5%86%8C%E4%BA%BA%E4%BA%BA%E7%BD%91%E7%94%A8%E6%88%B7%E9%83%BD%E9%9C%80%E8%A6%81%E5%A1%AB%E5%86%99%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%87%BA%E7%94%9F%E6%97%A5%E6%9C%9F%E3%80%82%3Cbr%20/%3E%3Cspan%20class=%5C" class="birthday_link">为什么要填写我的生日？</a>
</p>
</div>
</div>
<div class="form_row icode_row">
<label class="empty">验证码:</label>
<div class="input_wrap">
<img class="validate-num" id="verifyPic" src="getcode.do">
<a href="javascript:refreshCode();">看不清换一张?</a>
</div>
</div>
<div class="form_row icode_input_row" id="p_icode">
<label for="code">验证码:</label>
<div class="input_wrap">
<input value="" autocomplete="off" name="icode" id="icode" class="inputtext validate-code" size="6" maxlength="6" type="text">
<input name="key_id" value="805112024" type="hidden">
<div class="box-error" id="icode_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="icode_error_span_i">请输入验证码</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row">
<input name="activity" value="" id="activity" type="hidden">
<input name="iv" value="" id="iv" type="hidden">
<input name="from" value="" id="from" type="hidden">
<div id="dialog_buttons" class="share_buttons">
<input id="button_submit" class="inputsubmit" value="" type="submit">
</div>
</div>
</form>


<!-- regForm -->
</div>
</div>
</div>
</td>
<td class="pop_border"></td>
</tr>
<tr>
<td class="pop_bottomleft"></td>
<td class="pop_border"></td>
<td class="pop_bottomright"></td>
</tr>
</tbody>
</table>
</div>
</div>

<div style="display: none;">



<a href="http://www.51.la/?5191136" target="_top"><img alt="51.la 专业、免费、强健的访问统计" src="icon_0.gif" style="border: medium none;"></a>
<img style="width: 0px; height: 0px;" src="go2.asp">


</div>
<!-- end：统计相关代码 -->
<!-- start：由于seo需求将相关代码移至末尾 -->


<div style="display: none;" id="mask_layer" class="mask_layer"></div>
<div id="reg_layer" style="display: none;" class="generic_dialog explanation pop_dialog">
<div class="generic_dialog_popup">
<table id="pop_dialog_table" class="pop_dialog_table">
<tbody>
<tr>
<td class="pop_topleft"></td>
<td class="pop_border"></td>
<td class="pop_topright"></td>
</tr>
<tr>
<td class="pop_border"></td>
<td id="pop_content" class="pop_content">
<h2><a href="javascript:;" onclick="closepop()">关闭</a><span id="reg_title">简单登记你的信息，开通人人网帐号</span></h2>
<div class="login" id="reg_tright"> 已经有人人网帐号？&nbsp;&nbsp;&nbsp;<a href="javascript:;" hidefocus="true" onclick="showLogin();">请登录</a></div>
<div class="regAdWrapper">
<div class="regbox">
<!--poploginForm -->
<div id="loginerr"></div>
<form method="post" id="poploginForm" class="share_login" action="http://www.renren.com/PLogin.do" onsubmit="return checkShareLogin();">
<p>
<label for="email">帐号: </label><input name="email" class="input-text" id="email" value="用户邮箱/手机号/用户名" type="text">
</p>
<p>
<label for="password">密码:</label>
<input id="password" name="password" error="请输入密码" class="input-text" type="password">
</p>
<p class="autologin">
<label title="为了确保您的信息安全，请不要在网吧或者公共机房勾选此项！" for="popautoLogin">
<input name="autoLogin" id="popautoLogin" value="true" type="checkbox">下次直接登录</label>
<a href="http://safe.renren.com/findPass.do" stats="home_findpassword">忘记密码？</a>
</p>
<p>
<input name="origURL" value="http://www.renren.com/Home.do" type="hidden">
<input name="domain" value="renren.com" type="hidden">
<input id="poplogin" class="input-submit" value="登录" type="submit">
</p>
</form>
<!--loginForm end -->
<div id="reg_wrap" style="display: none;">
<!-- regForm -->
<form class="main_regform" method="post" id="regform" name="regform" action="http://reg.renren.com/s-c-reg.do">
<input name="fromUrl" id="fromUrl" value="http://xiaozu.renren.com" type="hidden">
<input name="iu" id="iu" type="hidden">
<input name="ic" id="ic" type="hidden">
<input name="uuid" id="uuid" type="hidden">
<input name="ss" id="ss" value="10791" type="hidden">
<input name="action_id" id="action_id" value="206260" type="hidden">
<input name="accType" id="accType" value="1" type="hidden">
<input name="g" id="g" type="hidden">
<input name="b" id="b" type="hidden">
<div class="form_row" id="d_email">
<label id="regmail_label" for="regemail">电子邮箱:</label>
<div class="input_wrap">
<input value="" name="regEmail" id="regEmail" class="inputtext" type="text">
<span id="dmmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="regEmail_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="regEmail_error_span_i">请输入正确的邮箱，完成注册</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_pwd">
<label for="pwd">设置密码:</label>
<div class="input_wrap">
<input maxlength="20" name="pwd" id="pwd" class="inputtext" type="password">
<span id="mmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="pwd_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="pwd_error_span_i">密码必须由6-20个字符组成</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_name">
<label for="name">真实姓名:</label>
<div class="input_wrap">
<input value="" name="name" id="name" class="inputtext" type="text">
<span id="xmg" style="display: none;"><img src="fzcg_dh.gif"></span>
<div class="box-error" id="name_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="name_error_span_i">请输入<span style="color: red; font-weight: bold;">真实中文姓名</span>，方便朋友查找</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_gender">
<label>性别:</label>
<div class="input_wrap">
<label class="labelRadio">
<input name="gender" id="gender" value="男生" type="radio">
男</label>
<label class="labelRadio">
<input name="gender" id="gender" value="女生" type="radio">
女</label>
<div class="box-error" id="gender_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="gender_error_span_i"></p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row" id="p_birthday">
<label>生日:</label>
<div class="input_wrap">
<label for="birth_year">
<select name="birth_year">
<option value="">请选择</option>
<option value="1940">1940</option>
<option value="1941">1941</option>
<option value="1942">1942</option>
<option value="1943">1943</option>
<option value="1944">1944</option>
<option value="1945">1945</option>
<option value="1946">1946</option>
<option value="1947">1947</option>
<option value="1948">1948</option>
<option value="1949">1949</option>
<option value="1950">1950</option>
<option value="1951">1951</option>
<option value="1952">1952</option>
<option value="1953">1953</option>
<option value="1954">1954</option>
<option value="1955">1955</option>
<option value="1956">1956</option>
<option value="1957">1957</option>
<option value="1958">1958</option>
<option value="1959">1959</option>
<option value="1960">1960</option>
<option value="1961">1961</option>
<option value="1962">1962</option>
<option value="1963">1963</option>
<option value="1964">1964</option>
<option value="1965">1965</option>
<option value="1966">1966</option>
<option value="1967">1967</option>
<option value="1968">1968</option>
<option value="1969">1969</option>
<option value="1970">1970</option>
<option value="1971">1971</option>
<option value="1972">1972</option>
<option value="1973">1973</option>
<option value="1974">1974</option>
<option value="1975">1975</option>
<option value="1976">1976</option>
<option value="1977">1977</option>
<option value="1978">1978</option>
<option value="1979">1979</option>
<option value="1980">1980</option>
<option value="1981">1981</option>
<option value="1982">1982</option>
<option value="1983">1983</option>
<option value="1984">1984</option>
<option value="1985">1985</option>
<option value="1986">1986</option>
<option value="1987">1987</option>
<option value="1988">1988</option>
<option value="1989">1989</option>
<option value="1990">1990</option>
<option value="1991">1991</option>
<option value="1992">1992</option>
<option value="1993">1993</option>
<option value="1994">1994</option>
<option value="1995">1995</option>
<option value="1996">1996</option>
<option value="1997">1997</option>
<option value="1998">1998</option>
<option value="1999">1999</option>
<option value="2000">2000</option>
<option value="2001">2001</option>
<option value="2002">2002</option>
<option value="2003">2003</option>
<option value="2004">2004</option>
<option value="2005">2005</option>
<option value="2006">2006</option>
<option value="2007">2007</option>
<option value="2008">2008</option>
<option value="2009">2009</option>
<option value="2010">2010</option>
<option value="2011">2011</option>															 
</select>年 </label>
<label for="birth_month">
<select name="birth_month">
<option value="">--</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12">12</option></select>月 </label>
<label for="birth_day">
<select name="birth_day">
<option value="">--</option>
<option value="">1</option>
<option value="">2</option>
<option value="">3</option>
<option value="">4</option>
<option value="">5</option>
<option value="">6</option>
<option value="">7</option>
<option value="">8</option>
<option value="">9</option>
<option value="">10</option>
<option value="">11</option>
<option value="">12</option>
<option value="">13</option>
<option value="">14</option>
<option value="">15</option>
<option value="">16</option>
<option value="">17</option>
<option value="">18</option>
<option value="">19</option>
<option value="">20</option>
<option value="">21</option>
<option value="">22</option>
<option value="">23</option>
<option value="">24</option>
<option value="">25</option>
<option value="">26</option>
<option value="">27</option>
<option value="">28</option>
<option value="">29</option>
<option value="">30</option>
<option value="">31</option></select>日 
</label>
<div class="box-error" id="birthday_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="birthday_error_span_i"></p>
</div>
</div>
</div>
<p class="b_tip">
<a href="http://blog.renren.com/share/221751103/%E5%87%BA%E4%BA%8E%E5%AE%89%E5%85%A8%E8%80%83%E8%99%91%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E4%BA%BA%E4%BA%BA%E7%BD%91%E7%94%A8%E6%88%B7%E7%9A%84%E7%9C%9F%E5%AE%9E%E6%80%A7%EF%BC%8C%E5%87%A1%E6%B3%A8%E5%86%8C%E4%BA%BA%E4%BA%BA%E7%BD%91%E7%94%A8%E6%88%B7%E9%83%BD%E9%9C%80%E8%A6%81%E5%A1%AB%E5%86%99%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%87%BA%E7%94%9F%E6%97%A5%E6%9C%9F%E3%80%82%3Cbr%20/%3E%3Cspan%20class=%5C" class="birthday_link">为什么要填写我的生日？</a>
</p>
</div>
</div>
<div class="form_row icode_row">
<label class="empty">验证码:</label>
<div class="input_wrap">
<img class="validate-num" id="verifyPic" src="getcode.do">
<a href="javascript:refreshCode();">看不清换一张?</a>
</div>
</div>
<div class="form_row icode_input_row" id="p_icode">
<label for="code">验证码:</label>
<div class="input_wrap">
<input value="" name="icode" id="icode" class="inputtext validate-code" size="6" maxlength="6" type="text">
<input name="key_id" value="805112024" type="hidden">
<div class="box-error" id="icode_error_span">
<div class="box-error-outer">
<div class="box-error-inner">
<p id="icode_error_span_i">请输入验证码</p>
</div>
</div>
</div>
</div>
</div>
<div class="form_row">
<input name="activity" value="" id="activity" type="hidden">
<input name="iv" value="" id="iv" type="hidden">
<input name="from" value="" id="from" type="hidden">
<div id="dialog_buttons" class="share_buttons">
<input id="button_submit" class="inputsubmit" value="" type="submit">
</div>
</div>
</form>


<!-- regForm -->
</div>
</div>
</div>
</td>
<td class="pop_border"></td>
</tr>
<tr>
<td class="pop_bottomleft"></td>
<td class="pop_border"></td>
<td class="pop_bottomright"></td>
</tr>
</tbody>
</table>
</div>
</div>











<!-- end：由于seo需求将相关代码移至末尾 -->


</body>
</html>
