<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">






<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body><div id="bd_snap">
    <div id="bd_snap_head">
        <a href="http://www.baidu.com/" id="bd_snap_logo" title="到百度首页"></a>
    </div>
    <div id="bd_snap_txt">您查询的关键词是：<span><a style="color: black; background-color: rgb(255, 255, 102); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4#baidusnap0">winsock</a><a style="color: black; background-color: rgb(153, 255, 153); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4#baidusnap2">主机</a><a style="color: black; background-color: rgb(255, 153, 153); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4#baidusnap3">名</a><a style="color: black; background-color: rgb(255, 102, 255); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4#baidusnap4">获取</a><a style="color: white; background-color: rgb(136, 0, 0); padding: 0pt 3px; font-weight: bold;" href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4#baidusnap5">ip</a></span> 。如果打开速度慢，可以尝试<a href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2&amp;p=9a759a46d0c650fc57e8d239135392&amp;user=baidu&amp;fm=sc&amp;query=winsock+%CD%A8%B9%FD%D6%F7%BB%FA%C3%FB%BB%F1%C8%A1ip&amp;qid=b2adc0390fcad614&amp;p1=4&amp;fast=y">快速版</a>；如果想保存快照，可以<a onclick="window.open('http://cang.baidu.com/do/add?it='+encodeURIComponent(document.title)+'&amp;iu='+encodeURIComponent(location.href)+'&amp;fr=ps#nw=1','_s','scrollbars=no,width=600,height=450,right=75,top=20,status=no,resizable=yes'); return false;" href="http://cang.baidu.com/do/add" target="_top">添加到搜藏</a>；如果想更新或删除快照，可以<a href="http://tousu.baidu.com/webmaster/add?link=http%3A%2F%2Fcache.baidu.com%2Fc%3Fm%3D9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c422461d1c21b4fb25290d57938327365ff8540abdb6652969423db19cc88848d7b8866d72c8713b3547da004f8240b8cb3732b0568729e3b869ecad844484afa2c4a95044be56120af0e7ff291715ba7881152697d68e49654860cafa4466e8287d3eec2057b737a2a2%26p%3D9a759a46d0c650fc57e8d239135392%26user%3Dbaidu%26fm%3Dsc%26query%3Dwinsock%2B%25CD%25A8%25B9%25FD%25D6%25F7%25BB%25FA%25C3%25FB%25BB%25F1%25C8%25A1ip%26qid%3Db2adc0390fcad614%26p1%3D4" id="bd_tousu">投诉快照</a>。</div>

    <div id="bd_snap_note">(百度和网页<a href="http://blog.csdn.net/niuer09/article/details/4522081">http://blog.csdn.net/niuer09/article/details/4522081</a>的作者无关，不对其内容负责。百度快照谨为网络故障时之索引，不代表被搜索网站的即时页面。)</div>
</div>
<div id="bd_snap_search">
	<form action="http://www.baidu.com/s"><input name="cl" value="3" type="hidden"><input value="" name="wd" id="bd_snap_kw" maxlength="100"><span id="bd_snap_btn_wr"><input id="bd_snap_su" value="百度一下" class="bd_snap_btn" onmousedown="this.className='bd_snap_btn bd_snap_btn_h'" type="submit"></span></form>
</div>
<div id="bd_snap_ln"></div>
<div style="position: relative;">



<title>winsock下获取主机IP地址 - niuer09的专栏 - 博客频道 - CSDN.NET</title>

<meta name="description" content="/***************************************************************************功能：获取网络主机的相关信息(存储在hostent结构中)实现：gethostbyname()/gethostbyaddr()输入：1.主机名;2.主机ip地址;3.NULL-&gt;返回本机信息测试输入：NULL,Leen,shenji">




<link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://blog.csdn.net/niuer09/rss/list">
<link rel="shortcut icon" href="favicon.ico">





<div id="container">
<div id="header">
    <div class="header">
        <div id="blog_title">
            <h1>
                <a href="http://blog.csdn.net/niuer09">niuer09的专栏</a></h1>
            <h2></h2>
            <div class="clear">
            </div>
        </div>
        <div class="clear">
        </div>
    </div>
</div>
<div id="navigator">
    <div class="navigator_bg">
    </div>
    <div class="navigator">
        <ul>
            <!--<li id="btnHome"><a href="/niuer09"><span><img src="http://static.blog.csdn.net/images/ico_home.gif">我的首页</span></a></li>-->
            <li id="btnContents"><a href="http://blog.csdn.net/niuer09?viewmode=contents"><span><img src="ico_list.gif">目录视图</span></a></li>
            <li id="btnView"><a href="http://blog.csdn.net/niuer09?viewmode=list"><span><img src="ico_summary.gif">摘要视图</span></a></li>
            <li id="btnRss"><a href="http://blog.csdn.net/niuer09/rss/list"><span><img src="ico_rss.gif">订阅</span></a></li>
</ul>
    </div>
</div>

        
<div id="body">
<div id="main">
<div class="main">
<div class="notice"> 


<a href="http://blog.csdn.net/blogdevteam/article/details/7415936" target="_top"><font color="red">博客频道4月技术图书有奖试读火爆开启</font></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://www.mobileasiaexpo.cn/?MAECN=CSDN2" target="_top"><font color="blue">移动业界领袖会议·上海·6.20</font></a>
<br>
<a href="http://blog.csdn.net/blogdevteam/article/details/7489275" target="_top"><font color="blue">第四届云计算大会门票抢购：史上最低价，每日限5张！ </font></a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="http://topic.csdn.net/u/20120416/10/9123faba-8474-4f2a-a0cf-a1b7d0fe5913.html" target="_top"><font color="red">【分享季1】：网友推荐130个经典资源，分享再赠分！</font></a>

</div>

<div id="article_details" class="details">
    <div class="article_title">
    <span class="ico ico_type_Original"></span>
    <h3>
        <span class="link_title"><a name="baidusnap0"></a><a name="baidusnap4"></a><a name="baidusnap2"></a><a name="baidusnap5"></a><a href="http://blog.csdn.net/niuer09/article/details/4522081">
        <b style="color: black; background-color: rgb(255, 255, 102);">winsock</b>下<b style="color: black; background-color: rgb(255, 102, 255);">获取</b><b style="color: black; background-color: rgb(153, 255, 153);">主机</b><b style="color: white; background-color: rgb(136, 0, 0);">IP</b>地址
        </a></span>
    </h3>
</div>

        
    <div class="article_manage">
        <span class="link_categories">
        分类：
            <a href="http://blog.csdn.net/niuer09/article/category/589556">C/C++</a> 
        </span>
    <span class="link_postdate">2009-09-05 11:40</span>
    <span class="link_view" title="阅读次数">219人阅读</span>
    <span class="link_comments" title="评论次数"><a href="#comments">评论</a>(0)</span>
    <span class="link_collect"><a href="javascript:void(0);" onclick="javascript:collectArticle('winsock下获取主机IP地址','4522081');return false;" title="收藏">收藏</a></span>
    <span class="link_report"><a href="#report" onclick="javascript:report(4522081,2);return false;" title="举报">举报</a></span>
    
</div>

    
<div id="article_content" class="article_content">
    <p><textarea cols="89" rows="21" name="code" class="cpp">/***************************************************************************
功能：获取网络主机的相关信息(存储在hostent结构中)
实现：gethostbyname()/gethostbyaddr()
输入：1.主机名;2.主机ip地址;3.NULL-&gt;返回本机信息
测试输入：NULL,Leen,shenjing-pc,192.168.1.101,www.google.com,www.sina.com
***************************************************************************/
#include "../common/InitSock.h"
#include &lt;WS2TCPIP.H&gt;
int main()
{
 CInitSock sock; //ws2_32.dll的初试化和释放
 hostent* pHost; //structure to hold remote host's information,such as name,alias,ip,and so on
 char* hostName; //remote host name
 //unsigned long addr;
 IN_ADDR addr;
 while (TRUE)
 {
  printf("input host name or ip address,or 'q/Q' to quit:");
  hostName = (char*)malloc(16*sizeof(char));
  //fgets(hostName,16,stdin); //fgets会将末尾newline符号包含在hostName中,且末位追加NULL,最多能读取N-1个字符
  gets(hostName); //末尾newline用NULL替换
  // If the user input is an alpha name for the host, use gethostbyname()
  // If not, get host by addr (assume IPv4)
  if (isalpha(hostName[0]))
  {
   if ((hostName[0] == 'q') || (hostName[0] == 'Q'))
   {
    break;
   }
  // hostName[strlen(hostName) - 1] = '/0';
   pHost = gethostbyname(hostName);
  }
  else
  {
  // addr = inet_addr(hostName);
   addr.S_un.S_addr = inet_addr(hostName);
  // pHost = gethostbyaddr((char*)&amp;addr,4,AF_INET);
   pHost = gethostbyaddr((char*)&amp;addr.S_un.S_addr,4,AF_INET);
  }
  if (!pHost)
  {
   int errNo = WSAGetLastError();
   printf("Error:%d/n",errNo);
   if (errNo == 11001)
   {
    printf("Host not found./n");
   }
  }
  else
  {
   //use pHost to get remote host information
   IN_ADDR inAddr;
   char* szIp;
   printf("--------------------------------------/n");
   printf("主机名称为：%s/n",pHost-&gt;h_name);
   for (int i = 0;;i++)
   {
    char* p = pHost-&gt;h_addr_list[i]; //point to a 32 bits ip address
    if (p == NULL)
    {
     break;
    }
    memcpy(&amp;inAddr.S_un.S_addr,p,pHost-&gt;h_length);
    szIp = inet_ntoa(inAddr);
    printf("IP[%d]:%s/n",i,szIp);   
   }
   printf("--------------------------------------/n");
  }

 }
 free(hostName); 
 return 0;
}

说明：CInitSock为封装了ws2_32.dll初始化和释放的类，源码如下

include &lt;winsock2.h&gt;
#pragma comment(lib,"ws2_32.lib")
class CInitSock
{
public:
 CInitSock(BYTE minoVer = 2,BYTE majorVer = 2)
 {
  WSADATA wsaData;
  int ir;
  WSAStartup(MAKEWORD(minoVer,majorVer),&amp;wsaData);
  ir = WSAGetLastError();
  if (ir != 0)
  {
   exit(0);
  }
 }
 ~CInitSock()
 {
  WSACleanup();
 }
public:
private:
};
</textarea> </p>
</div>
<div class="share_buttons" id="sharePanel"></div>

<div class="article_next_prev">
        <li class="prev_article">
            <span>上一篇：</span><a href="http://blog.csdn.net/niuer09/article/details/4522073"> C语言去除空白字符trim函数的高效实现</a></li>
        <li class="next_article">
            <span>下一篇：</span><a href="http://blog.csdn.net/niuer09/article/details/4548011">函数调用方式CALLBACK与WINAPI</a></li>
</div>


</div>
<div id="ad_cen"></div>

<div id="comment_title" class="panel_head">查看评论<a name="comments"></a></div>
<div id="comment_list"></div>
<div id="comment_bar"></div>
<div id="comment_form"></div>
<div class="announce">* 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a name="reply"></a><a name="quote"></a></div>


<div id="ad_bot"></div>

<div id="report_dialog"></div>


<div class="clear"></div>
</div>
</div>
<div id="side">
    <div class="side">
<div id="panel_Profile" class="panel">
    <ul class="panel_head"><span>个人资料</span></ul>
    <ul class="panel_body profile">
        <div id="blog_userface">
            <a href="http://my.csdn.net/niuer09" target="_top">
            <img src="1_niuer09.jpg" title="访问我的空间" style="max-width: 90%;">
            </a>
            <br>
            <span><a href="http://my.csdn.net/niuer09" target="_top">niuer09</a></span>
        </div>
<div class="interact">
<!--<a href="#" class="attented" title="已关注"></a>-->
<a href="#" class="attent" id="span_add_follow" title="[加关注]"></a>
<a href="http://my.csdn.net/my/letter/send/niuer09" class="letter" title="[发私信]"></a>
</div>
        <div id="blog_medal">
        </div>
        <ul id="blog_rank">
            <li>访问：<span>2837次</span></li>
            <li>积分：<span>58分</span></li>
            <li>排<a name="baidusnap3"></a><b style="color: black; background-color: rgb(255, 153, 153);">名</b>：<span>千里之外</span></li>
        </ul>
        <ul id="blog_statistics">
            <li>原创：<span>2篇</span></li>
            <li>转载：<span>3篇</span></li>
            <li>译文：<span>0篇</span></li>
            <li>评论：<span>0条</span></li>
        </ul>
    </ul>
</div>



<div class="panel" id="panel_Search">
    <ul class="panel_head"><span>文章搜索</span></ul>
    <ul class="panel_body">
        <form id="frmSearch" action="http://so.csdn.net/search" class="form_search" target="_blank">
        <span><input value="" id="inputSearch" class="blogsearch" title="请输入关键字" type="text"></span>
        <input id="btnSubmit" value="搜索" title="search in blog" type="submit">
        <input name="q" id="inputQ" type="hidden">
        <input name="t" value="blog" type="hidden">
        <a id="btnSearchBlog" target="_blank"></a>
        </form>
    </ul>
</div><div id="panel_Category" class="panel">
    <ul class="panel_head"><span>文章分类</span></ul>
    <ul class="panel_body">
        <li>
        <a href="http://blog.csdn.net/niuer09/article/category/589556">C/C++</a><span>(3)</span>
        
        </li>
        <li>
        <a href="http://blog.csdn.net/niuer09/article/category/603085">网络编程</a><span>(1)</span>
        
        </li>
    </ul>
</div><div id="panel_Archive" class="panel">
    <ul class="panel_head"><span>文章存档</span></ul>
    <ul class="panel_body">
        <div id="archive_list">
        <!--归档统计-->
        <li><a href="http://blog.csdn.net/niuer09/article/month/2010/10">2010年10月</a>(1)</li><li><a href="http://blog.csdn.net/niuer09/article/month/2009/10">2009年10月</a>(1)</li><li><a href="http://blog.csdn.net/niuer09/article/month/2009/09">2009年09月</a>(3)</li>
        </div>
    </ul>
</div>
<div id="hotarticls" class="panel">
    <ul class="panel_head"><span>阅读排行</span></ul>
    <ul class="panel_body">
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/5961004" title="链表逆序">链表逆序</a> (1883)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4522073" title=" C语言去除空白字符trim函数的高效实现"> C语言去除空白字符trim函数的高效实...</a> (313)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4522081" title="winsock下获取主机IP地址"><b style="color: black; background-color: rgb(255, 255, 102);">winsock</b>下<b style="color: black; background-color: rgb(255, 102, 255);">获取</b><b style="color: black; background-color: rgb(153, 255, 153);">主机</b><b style="color: white; background-color: rgb(136, 0, 0);">IP</b>地址</a> (218)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4548011" title="函数调用方式CALLBACK与WINAPI">函数调用方式CALLBACK与WINAP...</a> (95)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4652303" title="同步 异步 阻塞 非阻塞的区别">同步 异步 阻塞 非阻塞的区别</a> (92)
        </li>
    </ul>
</div>
<div id="hotarticls" class="panel">
    <ul class="panel_head"><span>评论排行</span></ul>
    <ul class="panel_body">
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4522073" title=" C语言去除空白字符trim函数的高效实现"> C语言去除空白字符trim函数的高效实...</a> (0)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4522081" title="winsock下获取主机IP地址"><b style="color: black; background-color: rgb(255, 255, 102);">winsock</b>下<b style="color: black; background-color: rgb(255, 102, 255);">获取</b><b style="color: black; background-color: rgb(153, 255, 153);">主机</b><b style="color: white; background-color: rgb(136, 0, 0);">IP</b>地址</a> (0)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4548011" title="函数调用方式CALLBACK与WINAPI">函数调用方式CALLBACK与WINAP...</a> (0)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/4652303" title="同步 异步 阻塞 非阻塞的区别">同步 异步 阻塞 非阻塞的区别</a> (0)
        </li>
        <li>
            <a href="http://blog.csdn.net/niuer09/article/details/5961004" title="链表逆序">链表逆序</a> (0)
        </li>
    </ul>
</div>
<div id="homepageArticles" class="panel">
    <ul class="panel_head"><span>推荐文章</span></ul>
    <ul class="panel_body" id="ad_commend"></ul>
</div>

    </div>
    <div class="clear">
    </div>
</div>

<div class="clear"></div>
</div>














</div>


</div>



</body>
</html>
